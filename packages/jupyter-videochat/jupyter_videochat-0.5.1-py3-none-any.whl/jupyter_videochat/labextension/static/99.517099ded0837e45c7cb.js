(self.webpackChunkjupyterlab_videochat=self.webpackChunkjupyterlab_videochat||[]).push([[99],{99:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>T});var o,a=n(510),i=n(685),l=n(520),r=n(227),s=n(45),c=n(36),m=n(168),d=n(797),u=n(629),h=n(683);class g extends l.VDomModel{constructor(e){super(),this._rooms=[],this._isInitialized=!1,this._initialized=new d.PromiseDelegate,this.onSettingsChanged=()=>{this.stateChanged.emit(void 0)},this._meetChanged=new m.Signal(this)}get rooms(){return this._rooms}get isInitialized(){return this._isInitialized}get initialized(){return this._initialized.promise}get currentRoom(){return this._currentRoom}set currentRoom(e){this._currentRoom=e,this.stateChanged.emit(void 0),null!=e&&null==e.id&&this.createRoom(e).catch(console.warn)}get config(){return this._config}get meet(){return this._meet}set meet(e){this._meet!==e&&(this._meet=e,this._meetChanged.emit(void 0))}get meetChanged(){return this._meetChanged}get settings(){return this._settings}set settings(e){this._settings&&this._settings.changed.disconnect(this.onSettingsChanged,this),this._settings=e,this._settings&&this._settings.changed.connect(this.onSettingsChanged,this),this.stateChanged.emit(void 0)}get currentArea(){var e;return(null===(e=this.settings)||void 0===e?void 0:e.composite.area)||"right"}set currentArea(e){this.settings.set("area",e).catch(void 0)}initialize(){Promise.all([this.updateConfig(),this.updateRooms()]).then((()=>{this._isInitialized=!0,this._initialized.resolve(void 0),this.stateChanged.emit(void 0)})).catch(console.warn)}async updateConfig(){this._config=await p("config"),this.stateChanged.emit(void 0)}async updateRooms(){this._rooms=await p("rooms"),this.stateChanged.emit(void 0)}async createRoom(e){const t=await p("generate-room",{method:"POST",body:JSON.stringify(e)});return this.currentRoom=t,t}getJitsiAPI(){return()=>{var e;if(o.api)return o.api;if(null!=this.config){const t=`https://${(null===(e=this.config)||void 0===e?void 0:e.jitsiServer)?this.config.jitsiServer:c.cE}/external_api.js`;o.ensureExternalAPI(t).then((()=>this.stateChanged.emit(void 0))).catch(console.warn)}return null}}}async function p(e,t={}){const n=h.ServerConnection.makeSettings(),o=u.URLExt.join(n.baseUrl,c.Pj,e);let a;try{a=await h.ServerConnection.makeRequest(o,t,n)}catch(e){throw new h.ServerConnection.NetworkError(e)}const i=await a.json();if(!a.ok)throw new h.ServerConnection.ResponseError(a,i.message);return i}!function(e){let t,n;e.ensureExternalAPI=async function(o){return null==n&&(n=new d.PromiseDelegate,t=document.createElement("script"),t.id=`id-${c.ux}-external-api`,t.src=o,t.async=!0,t.type="text/javascript",document.body.appendChild(t),t.onload=()=>{e.api=window.JitsiMeetExternalAPI,n.resolve(e.api)}),n.promise}}(o||(o={}));var v=n(271),b=n.n(v),w=n(802);const C=e=>{const t=b().createRef();return(0,v.useEffect)((()=>{const n={roomName:e.room.id,parentNode:t.current,userInfo:{displayName:u.PageConfig.getOption("hubUser")}},{displayName:o,email:a,configOverwrite:i,interfaceConfigOverwrite:l}=e;let r;null!=o&&(n.userInfo.displayName=o),null!=a&&(n.userInfo.email=a),null!=i?n.configOverwrite=i:console.warn("No Jitsi third-party requests will be blocked"),null!=l?n.interfaceConfigOverwrite=l:console.warn("All Jitsi features will be enabled");let s=e.jitsiAPI();return null==s?console.info("Jitsi API not yet loaded, will try again in a moment"):r=new s(e.domain,n),r&&(e.onMeet(r),r.executeCommand("subject",e.room.displayName),r.on("readyToClose",(()=>e.onRoomSelect(null)))),()=>{e.onMeet(null),r&&r.dispose()}})),b().createElement("div",{className:`${c.ux}-jitsi-container`,ref:t})},f='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n  \x3c!-- https://fonts.gstatic.com/s/i/materialicons/voice_chat/v6/24px.svg?download=true --\x3e\n  \x3c!-- https://raw.githubusercontent.com/google/material-design-icons/master/LICENSE --\x3e\n  <path d="M0 0h24v24H0z" fill="none" />\n  <g class="jp-icon3 jp-icon-selectable" fill="#616161">\n    <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12l-4-3.2V14H6V6h8v3.2L18 6v8z" />\n  </g>\n</svg>\n',E=new w.LabIcon({name:`${c.NS}:chat`,svgstr:f}),y=new w.LabIcon({name:`${c.NS}:chat-pretty`,svgstr:f.replace("jp-icon3","jp-icon-brand0")}),N=new w.LabIcon({name:`${c.NS}:group`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24">\n    <rect fill="none" height="24" width="24"/>\n    <g class="jp-icon3 jp-icon-selectable" fill="#616161">\n        <path d="M12,12.75c1.63,0,3.07,0.39,4.24,0.9c1.08,0.48,1.76,1.56,1.76,2.73L18,18H6l0-1.61c0-1.18,0.68-2.26,1.76-2.73 C8.93,13.14,10.37,12.75,12,12.75z M4,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C2,12.1,2.9,13,4,13z M5.13,14.1 C4.76,14.04,4.39,14,4,14c-0.99,0-1.93,0.21-2.78,0.58C0.48,14.9,0,15.62,0,16.43V18l4.5,0v-1.61C4.5,15.56,4.73,14.78,5.13,14.1z M20,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C18,12.1,18.9,13,20,13z M24,16.43c0-0.81-0.48-1.53-1.22-1.85 C21.93,14.21,20.99,14,20,14c-0.39,0-0.76,0.04-1.13,0.1c0.4,0.68,0.63,1.46,0.63,2.29V18l4.5,0V16.43z M12,6c1.66,0,3,1.34,3,3 c0,1.66-1.34,3-3,3s-3-1.34-3-3C9,7.34,10.34,6,12,6z"/>\n    </g>\n</svg>\n'}),j=new w.LabIcon({name:`${c.NS}:group-new`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n    <path d="M0 0h24v24H0z" fill="none"/>\n    <g class="jp-icon3 jp-icon-selectable" fill="#616161">\n        <path d="M8 10H5V7H3v3H0v2h3v3h2v-3h3v-2zm10 1c1.66 0 2.99-1.34 2.99-3S19.66 5 18 5c-.32 0-.63.05-.91.14.57.81.9 1.79.9 2.86s-.34 2.04-.9 2.86c.28.09.59.14.91.14zm-5 0c1.66 0 2.99-1.34 2.99-3S14.66 5 13 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm6.62 2.16c.83.73 1.38 1.66 1.38 2.84v2h3v-2c0-1.54-2.37-2.49-4.38-2.84zM13 13c-2 0-6 1-6 3v2h12v-2c0-2-4-3-6-3z"/>\n    </g>\n</svg>\n'}),S=new w.LabIcon({name:`${c.NS}:public`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n    <path d="M0 0h24v24H0z" fill="none"/>\n    <g class="jp-icon3 jp-icon-selectable" fill="#616161">\n        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>\n    </g>\n</svg>\n'}),R=new w.LabIcon({name:`${c.NS}:user`,svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">\n    <g class="jp-icon3 jp-icon-selectable" fill="#616161">\n        <path d="M0 0h24v24H0z" fill="none"/><path d="M3 5v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.11 0-2 .9-2 2zm12 4c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zm-9 8c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1H6v-1z"/>\n    </g>\n</svg>\n'}),x={tag:"span",width:"20px",height:"20px"},I=b().createElement("li",null,b().createElement("blockquote",null,b().createElement("p",null,b().createElement("strong",null,"No named Hub rooms are configured.")),b().createElement("p",null,b().createElement("em",null,"Create or join a Hub room by name below.")))),$={target:"_blank",rel:"noopener noreferrer"},O=e=>{const[t,n]=(0,v.useState)(""),[o,a]=(0,v.useState)("");return b().createElement("div",{className:`${c.ux}-rooms`},b().createElement("label",{id:`id-${c.ux}-user-info`},b().createElement(R.react,Object.assign({},x)),"My Chat Info"),b().createElement("ul",{"aria-labelledby":`id-${c.ux}-user-info`},b().createElement("li",{className:`${c.ux}-input-group`},b().createElement("label",null,"Name"),b().createElement("input",{className:"jp-mod-styled",onInput:t=>e.onDisplayNameChanged(t.currentTarget.value),defaultValue:e.displayName}),b().createElement("blockquote",null,"(optional) Default name to show to other chat participants")),b().createElement("li",{className:`${c.ux}-input-group`},b().createElement("label",null,"Email"),b().createElement("input",{className:"jp-mod-styled",onInput:t=>e.onEmailChanged(t.currentTarget.value),defaultValue:e.email}),b().createElement("blockquote",null,"(optional) Email to show to other chat participants. If an avatar icon is registered with this address at"," ",b().createElement("a",Object.assign({href:"https://gravatar.com"},$),"gravatar.com"),", an icon will be shown."))),b().createElement("label",{id:`id-${c.ux}-hub-room-list`},b().createElement(N.react,Object.assign({},x)),"Select Hub room to join"),b().createElement("ul",{"aria-labelledby":`id-${c.ux}-hub-room-list`},e.rooms.length?e.rooms.map(((t,n)=>b().createElement("li",{key:t.id},b().createElement("label",null,t.displayName),b().createElement("button",{className:"jp-mod-styled jp-mod-accept",onClick:()=>e.onRoomSelect(t)},"JOIN"),b().createElement("blockquote",null,t.description)))):I),b().createElement("label",{id:`id-${c.ux}-new-room-list`},b().createElement(j.react,Object.assign({},x)),"Join Hub room by name"),b().createElement("ul",{"aria-labelledby":`id-${c.ux}-new-room-list`},b().createElement("li",null,b().createElement("div",{className:`${c.ux}-room-displayname-input`},b().createElement("input",{className:"jp-mod-styled",placeholder:"Hub Room Name",onInput:e=>n(e.currentTarget.value)}),b().createElement("button",{className:"jp-mod-styled "+(t.trim().length?"jp-mod-accept":""),disabled:!t.trim().length,onClick:()=>e.onCreateRoom({displayName:t})},"JOIN")),b().createElement("blockquote",null,"Join (or create) a named room. Share this name with other users of your Hub."))),e.disablePublicRooms?b().createElement(b().Fragment,null):b().createElement("label",{id:`id-${c.ux}-public-room-list`},b().createElement(S.react,Object.assign({},x)),"Join Public room by name"),e.disablePublicRooms?b().createElement(b().Fragment,null):b().createElement("ul",{"aria-labelledby":`id-${c.ux}-public-room-list`},b().createElement("li",null,b().createElement("div",{className:`${c.ux}-room-displayname-input`},b().createElement("input",{className:"jp-mod-styled",placeholder:"Public Room ID",onInput:e=>a(e.currentTarget.value)}),b().createElement("button",{className:"jp-mod-styled "+(o.trim().length?"jp-mod-accept":""),disabled:!o.trim().length,onClick:()=>e.onRoomSelect({displayName:o,id:o})},"JOIN")),b().createElement("blockquote",null,"Join (or create) a ",b().createElement("b",null,"public")," room. Share this name with anyone who can access"," ",b().createElement("a",Object.assign({href:`https://${e.domain}`},$),e.domain),"."))))},z=e=>{var t,n;const o=null===(t=e.config)||void 0===t?void 0:t.jitsiServer,a=!!e.currentRoom;return b().createElement(b().Fragment,null,b().createElement("div",{className:`${c.ux}-toolbar jp-Toolbar`},b().createElement("div",{className:"jp-ToolbarButton jp-Toolbar-item"},b().createElement(l.ToolbarButtonComponent,{tooltip:"Toggle Video Chat Sidebar",icon:w.launcherIcon,label:"Toggle Sidebar",onClick:e.onToggleSidebar})),b().createElement("div",{className:"jp-Toolbar-item jp-Toolbar-spacer"}),b().createElement("div",{className:"jp-ToolbarButton jp-Toolbar-item"},b().createElement(l.ToolbarButtonComponent,{icon:w.stopIcon,label:a?`Disconnect ${o}`:`Not connected to ${o}`,enabled:a,onClick:()=>e.onRoomSelect(null)}))),null!=o&&null!=(null===(n=e.currentRoom)||void 0===n?void 0:n.id)?b().createElement(C,{jitsiAPI:e.jitsiAPI,room:e.currentRoom,domain:o,onRoomSelect:e.onRoomSelect,onMeet:e.onMeet,email:e.email,displayName:e.displayName,configOverwrite:e.configOverwrite,interfaceConfigOverwrite:e.interfaceConfigOverwrite}):b().createElement(O,{currentRoom:e.currentRoom,onCreateRoom:e.onCreateRoom,onRoomSelect:e.onRoomSelect,onEmailChanged:e.onEmailChanged,onDisplayNameChanged:e.onDisplayNameChanged,rooms:e.rooms,email:e.email,displayName:e.displayName,domain:o,disablePublicRooms:e.disablePublicRooms}))};class _ extends l.VDomRenderer{constructor(e,t){super(e),this.onRoomSelect=e=>{this.model.currentRoom=e},this.onCreateRoom=e=>{this.model.createRoom(e).catch(console.warn)},this.onMeet=e=>{this.model.meet=e},this.onEmailChanged=e=>{var t;null===(t=this.model.settings)||void 0===t||t.set("email",e).catch(console.warn)},this.onDisplayNameChanged=e=>{var t;null===(t=this.model.settings)||void 0===t||t.set("displayName",e).catch(console.warn)},this.onToggleSidebar=t.onToggleSidebar,this.addClass(c.ux)}render(){const{settings:e}=this.model;return b().createElement(z,{jitsiAPI:this.model.getJitsiAPI(),onToggleSidebar:this.onToggleSidebar,onRoomSelect:this.onRoomSelect,onCreateRoom:this.onCreateRoom,onEmailChanged:this.onEmailChanged,onDisplayNameChanged:this.onDisplayNameChanged,onMeet:this.onMeet,currentRoom:this.model.currentRoom,config:this.model.config,rooms:this.model.rooms,email:`${(null==e?void 0:e.composite.email)||""}`,displayName:`${(null==e?void 0:e.composite.displayName)||""}`,configOverwrite:null==e?void 0:e.composite.configOverwrite,interfaceConfigOverwrite:null==e?void 0:e.composite.interfaceConfigOverwrite,disablePublicRooms:!!(null==e?void 0:e.composite.disablePublicRooms)})}}const P="Video Chat",k="Video Chat",M={id:`${c.NS}:plugin`,autoStart:!0,requires:[l.ICommandPalette,i.IRouter,r.ISettingRegistry],optional:[s.ILauncher,i.ILayoutRestorer],provides:c.WL,activate:async function(e,t,n,o,i,r){const s=new g,{commands:m,shell:d}=e;let u,h,p=null;const v=new l.WidgetTracker({namespace:c.NS});function b(){u.title.caption=null!=p?p:P,u.title.label="main"===s.currentArea?u.title.caption:""}function w(e){e=e||s.currentArea,d.add(u,e),b(),u.update(),v.has(u)||v.add(u).catch(void 0),d.activateById(u.id)}return u&&!u.isDisposed||(h=new _(s,{onToggleSidebar:()=>{m.execute(c.OF.toggleArea,{}).catch(console.warn)}}),u=new a.Panel,u.addClass(`${c.ux}-wrapper`),u.id=`id-${c.NS}`,u.title.caption=P,u.title.closable=!1,u.title.icon=E,u.addWidget(h)),s.meetChanged.connect((()=>{s.meet?s.meet.on("subjectChange",(e=>{p=e.subject,b()})):p=null,b()})),o.load(M.id).then((e=>{s.settings=e,e.changed.connect((()=>w())),w()})).catch((()=>w())),m.addCommand(c.OF.open,{label:"Video Chat",icon:y,execute:async e=>{var t;await s.initialized,w(),(null===(t=s.currentRoom)||void 0===t?void 0:t.displayName)!==e.displayName&&(s.currentRoom={displayName:e.displayName})}}),m.addCommand(c.OF.toggleArea,{label:"Toggle Video Chat Sidebar",execute:async()=>{s.currentArea=["right","left"].includes(s.currentArea)?"main":"right"}}),m.addCommand(c.OF.routerStart,{label:"Open Video Chat from URL",execute:async e=>{const{request:t}=e,o=new URL(`http://example.com${t}`).searchParams.get(c.nF),a=async()=>{var e;n.routed.disconnect(a),(null===(e=s.currentRoom)||void 0===e?void 0:e.displayName)!=o&&await m.execute(c.OF.open,{displayName:o})};n.routed.connect(a)}}),t.addItem({command:c.OF.open,category:k}),t.addItem({command:c.OF.toggleArea,category:k}),n.register({command:c.OF.routerStart,pattern:/.*/,rank:29}),i&&i.add({command:c.OF.open,args:{area:"main"}}),r&&r.restore(v,{command:c.OF.open,name:()=>`id-${c.NS}`}).catch(console.warn),s.initialize(),s}},T=[M]},36:(e,t,n)=>{"use strict";n.d(t,{NS:()=>a,Pj:()=>i,ux:()=>l,nF:()=>r,cE:()=>s,OF:()=>c,WL:()=>m});var o=n(797);const a="jupyterlab-videochat",i="videochat",l="jp-VideoChat",r="jvc",s="meet.jit.si";var c;!function(e){e.open=`${a}:open`,e.toggleArea=`${a}:togglearea`,e.routerStart=`${a}:router`}(c||(c={}));const m=new o.Token(`${a}:IVideoChatManager`)}}]);