"use strict";
/* Copyright: Ankitects Pty Ltd and contributors
 * License: GNU AGPL, version 3 or later; http://www.gnu.org/licenses/agpl.html */
var ankiPlatform = "desktop";
var typeans;
var _updatingQA = false;
var qFade = 50;
var aFade = 0;
var onUpdateHook;
var onShownHook;
function _runHook(arr) {
    var promises = [];
    for (var i = 0; i < arr.length; i++) {
        promises.push(arr[i]());
    }
    return Promise.all(promises);
}
function _updateQA(html, fadeTime, onupdate, onshown) {
    // if a request to update q/a comes in before the previous content
    // has been loaded, wait a while and try again
    if (_updatingQA) {
        setTimeout(function () {
            _updateQA(html, fadeTime, onupdate, onshown);
        }, 50);
        return;
    }
    _updatingQA = true;
    onUpdateHook = [onupdate];
    onShownHook = [onshown];
    var qa = $("#qa");
    // fade out current text
    new Promise((resolve) => qa.fadeTo(fadeTime, 0, () => resolve()))
        // update text
        .then(() => {
        try {
            qa.html(html);
        }
        catch (err) {
            qa.html((`Invalid HTML on card: ${String(err).substring(0, 2000)}\n` +
                String(err.stack).substring(0, 2000)).replace(/\n/g, "<br />"));
        }
    })
        .then(() => _runHook(onUpdateHook))
        .then(() => 
    // @ts-ignore wait for mathjax to ready
    MathJax.startup.promise.then(() => {
        // @ts-ignore clear MathJax buffer
        MathJax.typesetClear();
        // @ts-ignore typeset
        return MathJax.typesetPromise(qa.slice(0, 1));
    }))
        // and reveal when processing is done
        .then(() => new Promise((resolve) => qa.fadeTo(fadeTime, 1, () => resolve())))
        .then(() => _runHook(onShownHook))
        .then(() => (_updatingQA = false));
}
function _showQuestion(q, bodyclass) {
    _updateQA(q, qFade, function () {
        // return to top of window
        window.scrollTo(0, 0);
        document.body.className = bodyclass;
    }, function () {
        // focus typing area if visible
        typeans = document.getElementById("typeans");
        if (typeans) {
            typeans.focus();
        }
    });
}
function _showAnswer(a, bodyclass) {
    _updateQA(a, aFade, function () {
        if (bodyclass) {
            //  when previewing
            document.body.className = bodyclass;
        }
        // scroll to answer?
        var e = $("#answer");
        if (e[0]) {
            e[0].scrollIntoView();
        }
    }, function () { });
}
const _flagColours = {
    1: "#ff6666",
    2: "#ff9900",
    3: "#77ff77",
    4: "#77aaff",
};
function _drawFlag(flag) {
    var elem = $("#_flag");
    if (flag === 0) {
        elem.hide();
        return;
    }
    elem.show();
    elem.css("color", _flagColours[flag]);
}
function _drawMark(mark) {
    var elem = $("#_mark");
    if (!mark) {
        elem.hide();
    }
    else {
        elem.show();
    }
}
function _typeAnsPress() {
    if (window.event.keyCode === 13) {
        pycmd("ans");
    }
}
function _emulateMobile(enabled) {
    const list = document.documentElement.classList;
    if (enabled) {
        list.add("mobile");
    }
    else {
        list.remove("mobile");
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmV2aWV3ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9xdC9hcXQvZGF0YS93ZWIvanMvcmV2aWV3ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBO2tGQUNrRjtBQUVsRixJQUFJLFlBQVksR0FBRyxTQUFTLENBQUM7QUFDN0IsSUFBSSxPQUFPLENBQUM7QUFDWixJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7QUFFeEIsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO0FBQ2YsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0FBRWQsSUFBSSxZQUFZLENBQUM7QUFDakIsSUFBSSxXQUFXLENBQUM7QUFFaEIsU0FBUyxRQUFRLENBQUMsR0FBeUI7SUFDdkMsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBRWxCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2pDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztLQUMzQjtJQUVELE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqQyxDQUFDO0FBRUQsU0FBUyxTQUFTLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsT0FBTztJQUNoRCxrRUFBa0U7SUFDbEUsOENBQThDO0lBQzlDLElBQUksV0FBVyxFQUFFO1FBQ2IsVUFBVSxDQUFDO1lBQ1AsU0FBUyxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2pELENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNQLE9BQU87S0FDVjtJQUVELFdBQVcsR0FBRyxJQUFJLENBQUM7SUFFbkIsWUFBWSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDMUIsV0FBVyxHQUFH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QUN6QjtBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBDb3B5cmlnaHQ6IEFua2l0ZWN0cyBQdHkgTHRkIGFuZCBjb250cmlidXRvcnNcbiAqIExpY2Vuc2U6IEdOVSBBR1BMLCB2ZXJzaW9uIDMgb3IgbGF0ZXI7IGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLmh0bWwgKi9cblxudmFyIGFua2lQbGF0Zm9ybSA9IFwiZGVza3RvcFwiO1xudmFyIHR5cGVhbnM7XG52YXIgX3VwZGF0aW5nUUEgPSBmYWxzZTtcblxudmFyIHFGYWRlID0gNTA7XG52YXIgYUZhZGUgPSAwO1xuXG52YXIgb25VcGRhdGVIb29rO1xudmFyIG9uU2hvd25Ib29rO1xuXG5mdW5jdGlvbiBfcnVuSG9vayhhcnI6ICgpID0+IFByb21pc2U8YW55PltdKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHZhciBwcm9taXNlcyA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcHJvbWlzZXMucHVzaChhcnJbaV0oKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKTtcbn1cblxuZnVuY3Rpb24gX3VwZGF0ZVFBKGh0bWwsIGZhZGVUaW1lLCBvbnVwZGF0ZSwgb25zaG93bikge1xuICAgIC8vIGlmIGEgcmVxdWVzdCB0byB1cGRhdGUgcS9hIGNvbWVzIGluIGJlZm9yZSB0aGUgcHJldmlvdXMgY29udGVudFxuICAgIC8vIGhhcyBiZWVuIGxvYWRlZCwgd2FpdCBhIHdoaWxlIGFuZCB0cnkgYWdhaW5cbiAgICBpZiAoX3VwZGF0aW5nUUEpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdXBkYXRlUUEoaHRtbCwgZmFkZVRpbWUsIG9udXBkYXRlLCBvbnNob3duKTtcbiAgICAgICAgfSwgNTApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgX3VwZGF0aW5nUUEgPSB0cnVlO1xuXG4gICAgb25VcGRhdGVIb29rID0gW29udXBkYXRlXTtcbiAgICBvblNob3duSG9vayA9IFtvbnNob3duXTtcblxuICAgIHZhciBxYSA9ICQoXCIjcWFcIik7XG5cbiAgICAvLyBmYWRlIG91dCBjdXJyZW50IHRleHRcbiAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gcWEuZmFkZVRvKGZhZGVUaW1lLCAwLCAoKSA9PiByZXNvbHZlKCkpKVxuICAgICAgICAvLyB1cGRhdGUgdGV4dFxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHFhLmh0bWwoaHRtbCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICBxYS5odG1sKFxuICAgICAgICAgICAgICAgICAgICAoXG4gICAgICAgICAgICAgICAgICAgICAgICBgSW52YWxpZCBIVE1MIG9uIGNhcmQ6ICR7U3RyaW5nKGVycikuc3Vic3RyaW5nKDAsIDIwMDApfVxcbmAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nKGVyci5zdGFjaykuc3Vic3RyaW5nKDAsIDIwMDApXG4gICAgICAgICAgICAgICAgICAgICkucmVwbGFjZSgvXFxuL2csIFwiPGJyIC8+XCIpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oKCkgPT4gX3J1bkhvb2sob25VcGRhdGVIb29rKSlcbiAgICAgICAgLnRoZW4oKCkgPT5cbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgd2FpdCBmb3IgbWF0aGpheCB0byByZWFkeVxuICAgICAgICAgICAgTWF0aEpheC5zdGFydHVwLnByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZSBjbGVhciBNYXRoSmF4IGJ1ZmZlclxuICAgICAgICAgICAgICAgIE1hdGhKYXgudHlwZXNldENsZWFyKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlIHR5cGVzZXRcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aEpheC50eXBlc2V0UHJvbWlzZShxYS5zbGljZSgwLCAxKSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICAgIC8vIGFuZCByZXZlYWwgd2hlbiBwcm9jZXNzaW5nIGlzIGRvbmVcbiAgICAgICAgLnRoZW4oKCkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHFhLmZhZGVUbyhmYWRlVGltZSwgMSwgKCkgPT4gcmVzb2x2ZSgpKSkpXG4gICAgICAgIC50aGVuKCgpID0+IF9ydW5Ib29rKG9uU2hvd25Ib29rKSlcbiAgICAgICAgLnRoZW4oKCkgPT4gKF91cGRhdGluZ1FBID0gZmFsc2UpKTtcbn1cblxuZnVuY3Rpb24gX3Nob3dRdWVzdGlvbihxLCBib2R5Y2xhc3MpIHtcbiAgICBfdXBkYXRlUUEoXG4gICAgICAgIHEsXG4gICAgICAgIHFGYWRlLFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyByZXR1cm4gdG8gdG9wIG9mIHdpbmRvd1xuICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSA9IGJvZHljbGFzcztcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gZm9jdXMgdHlwaW5nIGFyZWEgaWYgdmlzaWJsZVxuICAgICAgICAgICAgdHlwZWFucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidHlwZWFuc1wiKTtcbiAgICAgICAgICAgIGlmICh0eXBlYW5zKSB7XG4gICAgICAgICAgICAgICAgdHlwZWFucy5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgKTtcbn1cblxuZnVuY3Rpb24gX3Nob3dBbnN3ZXIoYSwgYm9keWNsYXNzKSB7XG4gICAgX3VwZGF0ZVFBKFxuICAgICAgICBhLFxuICAgICAgICBhRmFkZSxcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKGJvZHljbGFzcykge1xuICAgICAgICAgICAgICAgIC8vICB3aGVuIHByZXZpZXdpbmdcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSA9IGJvZHljbGFzcztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2Nyb2xsIHRvIGFuc3dlcj9cbiAgICAgICAgICAgIHZhciBlID0gJChcIiNhbnN3ZXJcIik7XG4gICAgICAgICAgICBpZiAoZVswXSkge1xuICAgICAgICAgICAgICAgIGVbMF0uc2Nyb2xsSW50b1ZpZXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKCkge31cbiAgICApO1xufVxuXG5jb25zdCBfZmxhZ0NvbG91cnMgPSB7XG4gICAgMTogXCIjZmY2NjY2XCIsXG4gICAgMjogXCIjZmY5OTAwXCIsXG4gICAgMzogXCIjNzdmZjc3XCIsXG4gICAgNDogXCIjNzdhYWZmXCIsXG59O1xuXG5mdW5jdGlvbiBfZHJhd0ZsYWcoZmxhZykge1xuICAgIHZhciBlbGVtID0gJChcIiNfZmxhZ1wiKTtcbiAgICBpZiAoZmxhZyA9PT0gMCkge1xuICAgICAgICBlbGVtLmhpZGUoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlbGVtLnNob3coKTtcbiAgICBlbGVtLmNzcyhcImNvbG9yXCIsIF9mbGFnQ29sb3Vyc1tmbGFnXSk7XG59XG5cbmZ1bmN0aW9uIF9kcmF3TWFyayhtYXJrKSB7XG4gICAgdmFyIGVsZW0gPSAkKFwiI19tYXJrXCIpO1xuICAgIGlmICghbWFyaykge1xuICAgICAgICBlbGVtLmhpZGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtLnNob3coKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF90eXBlQW5zUHJlc3MoKSB7XG4gICAgaWYgKCh3aW5kb3cuZXZlbnQgYXMgS2V5Ym9hcmRFdmVudCkua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgcHljbWQoXCJhbnNcIik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfZW11bGF0ZU1vYmlsZShlbmFibGVkOiBib29sZWFuKSB7XG4gICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3Q7XG4gICAgaWYgKGVuYWJsZWQpIHtcbiAgICAgICAgbGlzdC5hZGQoXCJtb2JpbGVcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGlzdC5yZW1vdmUoXCJtb2JpbGVcIik7XG4gICAgfVxufVxuIl19