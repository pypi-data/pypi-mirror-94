(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{485:function(e,t,s){"use strict";s.r(t);var i=s(10),n={name:"gsrp5-m2mlist-view",props:["metas","meta","model","root","view","field","mode","items","item_find","guid","parent","container","obj","rel","id1"],data:function(){return{fields:[],selectionFrom:{},selectionFromForm:{},slot_names:{},headers:[],find:"",footerprops:{itemsPerPageOptions:[25,50,100,-1]},selected:[]}},mixins:[{methods:{readonly:i.v,required:i.z,visible:i.D,on_find_many2many:i.l,selFrom:i.A,selFromForm:i.B,send:i.C}}],watch:{dialog(e){e||this.close()}},methods:{buildTemplate(){let e,t="";for(let s in this.view.columns)t=-1!=["char","varchar","many2one","related","date","time","datetime","timedelta"].indexOf(this.meta.columns[s].type)?"left":"right",e={text:this.meta.columns[s].label,value:s,align:"left",sortable:!0},"json"!=this.meta.columns[s].type&&this.headers.push(e),"json"!=this.meta.columns[s].type&&(this.fields.push(s),this.slot_names[s]="item."+s),("selection"==this.meta.columns[s].type||"referenced"==this.meta.columns[s].type&&"selection"==this.meta.columns[s].reftype)&&(this.selectionFromForm[s]=Object(i.B)(this.meta.columns[s].selections),this.selectionFrom[s]=Object(i.A)(this.meta.columns[s].selections));this.headers.push({text:"Actions",value:"action",sortable:!1})},on_add_row(e){let t=document.querySelector("main.v-content"),s=document.createElement("gsrp5-find-view");s.id="many2many_find_"+this.obj.replace(/\./g,"_"),document.querySelector("#container").append(s);let i=new(Vue.component("gsrp5-find-view"));i.model=this.obj,i.title="Find",i.oids=null,i.role="many2many-find",i.obj=this.view.viewname,i.rel=e,i.idx=-1,i.$set(i,"$parent",t.__vue__),i.$vuetify=this.$vuetify,i.$websocket=this.$websocket,i.$mount("#"+s.id)},deleteItem(e){const t=this.items.indexOf(e);confirm("Are you sure you want to delete this item?")&&this.items.splice(t,1)},onDelete(e){let t=-1;for(let s=0;s<this.items.length;s++)this.items[s].id==e[0]&&(t=s);t>=0&&this.items.splice(t,1)},deleteItemSingle(e){console.log("delete-item:",e),confirm("Are you sure you want to delete this item single?")&&null!=e.__data__.id&&36==e.__data__.id.length&&this.send("on_delete_single",["_cache","m2mremove",this.guid,{path:e.__path__,container:e.__container__,context:{}}])},onDeleteSingle(e){let t=-1;for(let s=0;s<this.items.length;s++)this.items[s].id==e[0]&&(t=s);t>=0&&this.items.splice(t,1)},on_delete_single(e){e.length>0&&this.$root.$websocket._components[this.root].on_modify_models(e[0])},m2m_put(e){this.send("on_m2m_put",["_cache","m2madd",this.guid,{model:this.model,container:this.container,fields:this.fields,obj:this.obj,rel:this.rel,id2:[e],context:{}}])},on_m2m_put(e){e.length>0&&e.length>0&&this.$root.$websocket._components[this.root].on_modify_models(e[0])}},created(){this.$root.$websocket.registerComponent({n:`${this.$options.name}:${this._uid}`,c:this})},mounted:function(){this.buildTemplate()},beforeDestroy:function(){this.$root.$websocket.unregisterComponent(`${this.$options.name}:${this._uid}`)}},o=s(19),a=Object(o.a)(n,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-layout",{attrs:{column:""}},["readonly"!=e.mode?s("v-flex",{attrs:{"justify-space-around":""}},[s("v-btn",{staticClass:"mb-2",attrs:{color:"primary",dark:""},on:{click:function(t){return e.on_find_many2many(e.item_find,e.field,e.view.viewname)}}},[e._v("Add")])],1):e._e(),e._v(" "),s("v-flex",[s("v-card",[s("v-card-title",[s("v-spacer"),e._v(" "),s("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.find,callback:function(t){e.find=t},expression:"find"}})],1)],1),e._v(" "),s("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.items,"footer-props":e.footerprops,"item-key":e.meta.names.rec_name?e.meta.names.rec_name:"id",search:e.find,"single-select":!1,"show-select":""},scopedSlots:e._u([e._l(e.fields,(function(t){return{key:e.slot_names[t],fn:function(i){var n=i.item;return[["many2one","related"].indexOf(e.meta.columns[t].type)>=0?[e._v(e._s(n.__data__[t].name))]:"selection"==e.meta.columns[t].type?[e._v(e._s(e.selectionFromForm[t][n.__data__[t]]))]:"boolean"==e.meta.columns[t].type?[s("v-checkbox",{attrs:{disabled:"","hide-details":""},model:{value:n.__data__[t],callback:function(s){e.$set(n.__data__,t,s)},expression:"item.__data__[field]"}})]:"datetime"==e.meta.columns[t].type?[e._v(e._s(e._f("formatDatetime")(n.__data__[t])))]:"date"==e.meta.columns[t].type?[e._v(e._s(e._f("formatDate")(n.__data__[t])))]:"time"==e.meta.columns[t].type?[e._v(e._s(e._f("formatTime")(n.__data__[t])))]:"timedelta"==e.meta.columns[t].type?[e._v(e._s(e._f("formatTimedelta")(n.__data__[t])))]:"referenced"==e.meta.columns[t].type?[["many2one","related"].indexOf(e.meta.columns[t].type)>=0?[e._v(e._s(n.__data__[t].name))]:"selection"==e.meta.columns[t].type?[e._v(e._s(e.selectionFromForm[t][n.__data__[t]]))]:"boolean"==e.meta.columns[t].type?[s("v-checkbox",{attrs:{disabled:"","hide-details":""},model:{value:n.__data__[t],callback:function(s){e.$set(n.__data__,t,s)},expression:"item.__data__[field]"}})]:"datetime"==e.meta.columns[t].type?[e._v(e._s(e._f("formatDatetime")(n.__data__[t])))]:"date"==e.meta.columns[t].type?[e._v(e._s(e._f("formatDate")(n.__data__[t])))]:"time"==e.meta.columns[t].type?[e._v(e._s(e._f("formatTime")(n.__data__[t])))]:"timedelta"==e.meta.columns[t].type?[e._v(e._s(e._f("formatTimedelta")(n.__data__[t])))]:[e._v(e._s(n[t]))]]:[e._v(e._s(n.__data__[t]))]]}}})),{key:"item.action",fn:function(t){var i=t.item;return[s("v-btn",{staticClass:"mx-0",attrs:{icon:""},on:{click:function(t){return e.deleteItemSingle(i)}}},[s("v-icon",{attrs:{color:"pink"}},[e._v("delete")])],1)]}}],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)],1)}),[],!1,null,null,null);t.default=a.exports}}]);