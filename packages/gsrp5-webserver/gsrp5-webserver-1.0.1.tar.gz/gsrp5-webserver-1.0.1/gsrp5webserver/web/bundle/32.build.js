(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{488:function(e,t,a){"use strict";a.r(t);var i=a(10),n=(a(20),{name:"gsrp5-o2mform-view",props:["metas","model","items","rel","mode","role","o2mfield","root","guid","container","parent"],data:()=>({swipeDirection:"None",page:1,circle:!0,disabled:!1,length:1,nextIcon:"mdi-menu-left",prevIcon:"mdi-menu-right",totalVisible:10,meta:null,views:null,name:null,obj:null,active:null,dialog:!0,valid:!1,rules:{},view:{},selected:[],menu:{},fields:[],formfields:[],o2mfields:[],blobfields:[],selectionFrom:{},selectionFromForm:{},c:{},d:{},m:{},item:null,actions:{}}),mixins:[{methods:{on_new_many2one:i.s,on_detail_many2one:i.h,on_edit_many2one:i.j,on_find_many2one:i.m,on_find_many2one_update:i.n,on_new_related:i.t,on_detail_related:i.i,on_edit_related:i.k,on_find_related:i.o,on_find_related_update:i.p,readonly:i.v,required:i.z,m2o_new:i.d,m2o_put:i.e,related_new:i.x,related_put:i.y,on_modify_models:i.r,visible:i.D,cache:i.a,on_cache:i.f,m2o_cache:i.c,on_m2o_cache:i.q,related_cache:i.w,on_related_cache:i.u,send:i.C}}],methods:{swipe(e){this.swipeDirection=e},validate(){this.$refs.form.validate()?this.snackbar=!0:this.snackbar=!1},on_selected(e){this.selected=e},on_input_pagination(e){this.item=this.items[e-1]},_fieldsBuild(e,t,a){let i,n,l;for(let s=0;s<t.length;s++)switch(i=t[s],this.metas[e].meta.columns[i].type){case"one2many":if(l=this.metas[e].meta.columns[i].obj,i in a[1]&&l!=a[1][i])continue;l in this.metas&&-1==this.o2mfields.indexOf(i)&&(n={},i==this.metas[e].meta.names.childs_id?n[i]=Object.keys(this.metas[l].views.list.columns):n[i]=this._fieldsBuild(l,Object.keys(this.metas[l].views.list.columns),this.metas[l].meta.schema),t[s]=n);break;case"many2many":n={},l=this.metas[e].meta.columns[i].obj,n[i]=Object.keys(this.metas[l].views.m2mlist.columns),t[s]=n;break;case"referenced":let o=this.metas[e].meta.columns[i].ref.split(".");l=this.metas[e].meta.columns[o[0]].obj}return t},previewImage:function(e){var t=e.target;if(t.files&&t.files[0]){var a=new FileReader;a.onload=e=>{this.$set(this.item.__data__,t.name,e.target.result),console.log("EVENT:",e);let a={path:this.item.__path__,key:t.name,value:this.item.__data__[t.name],context:{}};this.send(".ws-dummy",["_cache","cache",this.guid,a])},a.readAsDataURL(t.files[0])}},clearImage:function(e,t){e.__data__[t]="";let a={path:e.__path__,key:t,value:e.__data__[t],context:{}};this.send(".ws-dummy",["_cache","cache",this.guid,a])},buildFormFields(){let e=[];for(let t=0,a=Object.keys(this.view.columns);t<a.length;t++)["many2many","one2one","one2many","referenced"].indexOf(this.meta.columns[a[t]].type)<0&&(this.rules[a[t]]=[]),["text","xml","binary"].indexOf(this.meta.columns[a[t]].type)>=0&&this.blobfields.push(a[t]),"selection"==this.meta.columns[a[t]].type&&(this.selectionFromForm[a[t]]=Object(i.B)(this.metas[this.model].meta.columns[a[t]].selections),this.selectionFrom[a[t]]=Object(i.A)(this.metas[this.model].meta.columns[a[t]].selections)),["one2many"].indexOf(this.meta.columns[a[t]].type)<0?e.push(a[t]):this.o2mfields.indexOf(a[t])<0&&this.o2mfields.push(a[t]),["date","time","datetime"].indexOf(this.meta.columns[a[t]].type)<0&&(this.menu[a[t]]=!1);for(let e in this.rules)1==this.meta.columns[e].required&&this.rules[e].push(t=>!!t||this.meta.columns[e].label+" is required"),"pattern"in this.meta.columns[e]&&null!=this.meta.columns[e].pattern&&this.rules[e].push(t=>new RegExp(this.meta.columns[e].pattern).test(t)||this.meta.columns[e].label+" must be valid for paterrn:"+this.meta.columns[e].pattern);return e},add_row(e,t,a){this.send("on_add_row",["_cache","add",this.guid,{model:e,container:t,context:{},view:a}])},on_add_row(e){this.$root.$websocket._components[this.root].on_modify_models(e[0])},do_action(e,t){this.send("onAction",["_cache","action",this.guid,{path:t.__path__,name:e}])},onAction(e){console.log("On Action MSG:",e)},onRead:function(e){if(e.length>0)for(let t in e[0])"id"!=t&&this.$set(this.item.__data__,t,e[0][t])}},created:function(){this.$websocket.registerComponent({n:`${this.$options.name}:${this._uid}`,c:this})},mounted:function(){this.meta=this.metas[this.model].meta,this.views=this.metas[this.model].views,this.view=this.views.form,this.name=this.meta.description,this.actions=this.meta.actions,this.length=this.items.length,this.$set(this,"fields",this._fieldsBuild(this.model,Object.keys(this.view.columns),this.meta.schema)),this.formfields=this.buildFormFields(),this.items.length>0&&"__meta__"in this.items[0]&&this.$set(this,"m",this.items[0].__meta__),this.$set(this,"item",this.items[0]),this.items.length>0&&"id"in this.item.__data__&&this.send("onRead",["models",this.model,"readforupdate",{fields:this.blobfields,ids:this.item.__data__.id,context:{}}])},beforeDestroy:function(){this.$websocket.unregisterComponent(`${this.$options.name}:${this._uid}`)}}),l=a(19),s=Object(l.a)(n,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",[a("v-card-title",[a("span",{staticClass:"headline"},[e._v(e._s(e.mode)+": "+e._s(e.name))])]),e._v(" "),a("v-card-text",[a("v-container",{attrs:{fluid:""}},[a("v-layout",{directives:[{name:"touch",rawName:"v-touch",value:{left:function(){return e.swipe("Left")},right:function(){return e.swipe("Right")},up:function(){return e.swipe("Up")},down:function(){return e.swipe("Down")}},expression:"{\n\t\t\t      left: () => swipe('Left'),\n\t\t\t      right: () => swipe('Right'),\n\t\t\t      up: () => swipe('Up'),\n\t\t\t      down: () => swipe('Down')\n\t\t\t    }"}],attrs:{column:""}},[null!=e.item?a("v-form",{ref:"form",attrs:{"lazy-validation":!0},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[Object.keys(e.actions).length>0?[a("h3",[e._v("Actions")]),e._v(" "),a("v-layout",{attrs:{row:""}},e._l(e.actions,(function(t,i){return a("v-btn",{key:i,attrs:{fab:"",dark:"",small:"",color:"purple darken-2"},on:{click:function(t){return e.do_action(i,e.item)}}},[e._v(e._s(t.icon))])})),1)]:e._e(),e._v(" "),a("v-flex",{attrs:{"justify-space-around":""}},["readonly"!=e.mode?a("v-btn",{staticClass:"mb-2",attrs:{color:"primary",dark:""},on:{click:function(t){return e.add_row(e.model,e.container,"list")}}},[e._v("Add")]):e._e()],1),e._v(" "),e._l(e.formfields,(function(t){return[["char","varchar","composite"].indexOf(e.meta.columns[t].type)>=0?[a("v-text-field",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{rules:e.rules[t],label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),clearable:"",counter:null!=e.meta.columns[t].size?e.meta.columns[t].size:1024},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]:["text","xml","jsonb"].indexOf(e.meta.columns[t].type)>=0?[a("v-textarea",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{rules:e.rules[t],label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),clearable:"",counter:null!=e.meta.columns[t].size?e.meta.columns[t].size:1024},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]:"many2one"==e.meta.columns[t].type?[a("v-layout",{directives:[{name:"show",rawName:"v-show",value:e.visible(t)&&t!=e.rel,expression:"visible(field) && field != rel"}],attrs:{row:""}},[a("v-text-field",{attrs:{rules:e.rules[t],label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),clearable:""},on:{change:function(a){return e.m2o_cache(e.item,t)}},model:{value:e.item.__data__[t].name,callback:function(a){e.$set(e.item.__data__[t],"name",a)},expression:"item.__data__[field].name"}}),e._v(" "),a("v-icon",{attrs:{fab:"",dark:"",small:"",color:"primary",disabled:null==e.item.__data__[t].name},on:{click:function(a){return e.on_detail_many2one(e.item,t)}}},[e._v("remove_red_eye")]),e._v(" "),a("v-icon",{attrs:{fab:"",dark:"",small:"",color:"primary",disabled:null==e.item.__data__[t].name},on:{click:function(a){return e.on_edit_many2one(e.item,t)}}},[e._v("edit")]),e._v(" "),a("v-icon",{attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:function(a){return e.on_new_many2one(e.item,t)}}},[e._v("add")]),e._v(" "),a("v-icon",{attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:function(a){return e.on_find_many2one(e.item,t)}}},[e._v("search")])],1)]:"related"==e.meta.columns[t].type?[a("v-layout",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{row:""}},[a("v-text-field",{attrs:{rules:e.rules[t],label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),clearable:""},on:{change:function(a){return e.related_cache(e.item,t,e.meta.columns[t].relatedy)}},model:{value:e.item.__data__[t].name,callback:function(a){e.$set(e.item.__data__[t],"name",a)},expression:"item.__data__[field].name"}}),e._v(" "),a("v-icon",{attrs:{fab:"",dark:"",small:"",color:"primary",disabled:null==e.item.__data__[t].name},on:{click:function(a){return e.on_detail_related(e.item,t)}}},[e._v("remove_red_eye")]),e._v(" "),a("v-icon",{attrs:{fab:"",dark:"",small:"",color:"primary",disabled:null==e.item.__data__[t].name},on:{click:function(a){return e.on_edit_related(e.item,t)}}},[e._v("edit")]),e._v(" "),a("v-icon",{attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:function(a){return e.on_new_related(e.item,t)}}},[e._v("add")]),e._v(" "),a("v-icon",{attrs:{fab:"",dark:"",small:"",color:"primary"},on:{click:function(a){return e.on_find_related(e.item,t)}}},[e._v("search")])],1)]:"selection"==e.meta.columns[t].type?[a("v-autocomplete",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{label:e.meta.columns[t].label,disabled:e.readonly(t),required:e.required(t),items:e.selectionFrom[t],"prepend-icon":null!=e.meta.columns[t].compute?"functions":"","hide-details":""},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]:"boolean"==e.meta.columns[t].type?[a("v-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{label:e.meta.columns[t].label,disabled:e.readonly(t),required:e.required(t),"prepend-icon":null!=e.meta.columns[t].compute?"functions":"","hide-details":""},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]:"datetime"==e.meta.columns[t].type?[a("v-datetime-picker",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),locale:"ru-ru",format:"YYYY-MM-DD HH:mm:ss Z"},on:{input:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]:"date"==e.meta.columns[t].type?[a("v-menu",{ref:t,refInFor:!0,attrs:{"close-on-content-click":!1,"nudge-right":40,"return-value":e.item.__data__[t],transition:"scale-transition","offset-y":"","min-width":"290px"},on:{"update:returnValue":function(a){return e.$set(e.item.__data__,t,a)},"update:return-value":function(a){return e.$set(e.item.__data__,t,a)}},scopedSlots:e._u([{key:"activator",fn:function(i){var n=i.on;return[a("v-text-field",e._g({attrs:{label:e.meta.columns[t].label,"prepend-icon":"event",readonly:""},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}},n))]}}],null,!0),model:{value:e.menu[t],callback:function(a){e.$set(e.menu,t,a)},expression:"menu[field]"}},[e._v(" "),a("v-date-picker",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),locale:"ru-ru",color:"green lighten-1","no-title":"",scrollable:""},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}}),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(a){e.menu[t]=!1}}},[e._v("Cancel")]),e._v(" "),a("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(a){return e.$refs[t][0].save(e.item.__data__[t])}}},[e._v("OK")])],1)]:"time"==e.meta.columns[t].type?[a("v-menu",{ref:t,refInFor:!0,attrs:{"close-on-content-click":!1,"nudge-right":40,"return-value":e.item.__data__[t],transition:"scale-transition","offset-y":"","max-width":"290px","min-width":"290px"},on:{"update:returnValue":function(a){return e.$set(e.item.__data__,t,a)},"update:return-value":function(a){return e.$set(e.item.__data__,t,a)}},scopedSlots:e._u([{key:"activator",fn:function(i){var n=i.on;return[a("v-text-field",e._g({attrs:{label:e.meta.columns[t].label,"prepend-icon":"access_time",readonly:""},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}},n))]}}],null,!0),model:{value:e.menu[t],callback:function(a){e.$set(e.menu,t,a)},expression:"menu[field]"}},[e._v(" "),a("v-time-picker",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),"prepend-icon":null!=e.meta.columns[t].compute?"functions":""},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})],1)]:"timedelta"==e.meta.columns[t].type?[a("v-text-field",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),clearable:"","prepend-icon":null!=e.meta.columns[t].compute?"functions":""},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]:"integer"==e.meta.columns[t].type||"float"==e.meta.columns[t].type||"double"==e.meta.columns[t].type||"real"==e.meta.columns[t].type||"decimal"==e.meta.columns[t].type?[a("v-text-field",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{rules:e.rules[t],label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),clearable:"","prepend-icon":null!=e.meta.columns[t].compute?"functions":""},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]:"numeric"==e.meta.columns[t].type?[a("v-text-field",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{rules:e.rules[t],label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),lazy:"",clearable:"","prepend-icon":null!=e.meta.columns[t].compute?"functions":""},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]:"binary"==e.meta.columns[t].type?[a("v-card",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}]},[a("v-card-title",[a("span",[e._v(e._s(e.meta.columns[t].label))])]),e._v(" "),a("v-responsive",[a("v-img",{staticClass:"preview",attrs:{src:e.item.__data__[t]?e.item.__data__[t]:"",width:"128px",height:"128px"}})],1),e._v(" "),a("v-card-actions",[a("div",{staticClass:"image-preview"},[a("input",{attrs:{type:"file",accept:e.meta.columns[t].accept,name:t,disabled:e.readonly(t)},on:{change:e.previewImage}}),e._v(" "),null!=e.item.__data__[t]&&e.item.__data__[t].length>0?a("v-icon",{on:{click:function(a){return e.clearImage(e.item,t)}}},[e._v(" clear")]):e._e()],1)])],1)]:"icon"==e.meta.columns[t].type?[a("v-card",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}]},[a("v-card-title",[a("span",[e._v(e._s(e.meta.columns[t].label))])]),e._v(" "),a("v-responsive",[a("v-img",{staticClass:"preview",attrs:{src:e.item.__data__[t]?e.item.__data__[t]:"",width:"75%",height:"75%"}})],1),e._v(" "),a("v-card-actions",[a("div",{staticClass:"image-preview"},[a("input",{attrs:{type:"file",accept:e.meta.columns[t].accept,name:t,disabled:e.readonly(t)},on:{change:e.previewImage}}),e._v(" "),null!=e.item.__data__[t]&&e.item.__data__[t].length>0?a("v-icon",{on:{click:function(a){return e.clearImage(e.item,t)}}},[e._v(" clear")]):e._e()],1)])],1)]:"many2many"==e.meta.columns[t].type?[a("gsrp5-m2mlist-view",{attrs:{metas:e.metas,meta:e.metas[e.meta.columns[t].obj].meta,model:e.item.__model__,view:e.metas[e.meta.columns[t].obj].views.m2mlist,items:e.item.__m2m_containers__[t],field:t,item_find:e.item.__data__[t],guid:e.guid,parent:e.item.__path__,container:t+"."+e.item.__path__,obj:e.meta.columns[t].obj,rel:e.meta.columns[t].rel,id1:e.item.__data__.id,root:e.root}})]:"referenced"==e.meta.columns[t].type?[["many2one","related"].indexOf(e.meta.columns[t].reftype)>=0?[e._v(e._s(e.item.__data__[t].name))]:"selection"==e.meta.columns[t].reftype?[e._v(e._s(e.selectionFromForm[t][e.item.__data__[t]]))]:"datetime"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatDatetime")(e.item.__data__[t])))]:"date"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatDate")(e.item.__data__[t])))]:"time"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatTime")(e.item.__data__[t])))]:"timedelta"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatTimedelta")(e.item.__data__[t])))]:("integer"==e.meta.columns[t].reftype||"float"==e.meta.columns[t].reftype||"double"==e.meta.columns[t].reftype||"real"==e.meta.columns[t].reftype||"decimal"==e.meta.columns[t].reftype||e.meta.columns[t].reftype,[e._v(e._s(e.item.__data__[t]))])]:[a("v-text-field",{directives:[{name:"show",rawName:"v-show",value:e.visible(t),expression:"visible(field)"}],attrs:{rules:e.rules[t],label:e.meta.columns[t].label,readonly:e.readonly(t),required:e.required(t),clearable:"","prepend-icon":null!=e.meta.columns[t].compute?"functions":""},on:{change:function(a){return e.cache(e.item,t)}},model:{value:e.item.__data__[t],callback:function(a){e.$set(e.item.__data__,t,a)},expression:"item.__data__[field]"}})]]}))],2):e._e(),e._v(" "),a("v-pagination",{attrs:{circle:e.circle,disabled:e.disabled,length:e.length,"next-icon":e.nextIcon,"prev-icon":e.prevIcon,page:e.page,"total-visible":e.totalVisible},on:{input:e.on_input_pagination},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1)],1)],1)],1)}),[],!1,null,null,null);t.default=s.exports}}]);