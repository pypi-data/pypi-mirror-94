(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{484:function(e,t,s){"use strict";s.r(t);var i=s(10),l={name:"gsrp5-find-view",props:{obj:{default:null},rel:{default:null},item_find:{type:Array,default:function(){return[]}},econd:{type:Array,default:function(){return[]}},oids:{type:Array,default:function(){return[]}}},data:()=>({dialog:!0,name:"",active:null,menu:{},metas:{},meta:{names:{rec_name:null},columns:{}},model:null,view:null,role:null,title:null,idx:-1,slot_names:{},selected:[],headers:[],items:[],selected:[],fields:[],footerprops:{itemsPerPageOptions:[25,50,100,-1]},item:{},selectionFrom:{},selectionFromForm:{},template:null,find:"",search:{},limit:80,cond:[]}),watch:{dialog(e){e||this.close()}},mixins:[{methods:{readonly:i.v,required:i.z,visible:i.D,send:i.C}}],methods:{buildTemplate:function(){for(let e in this.econd)e in this.search&&(this.search[e]=this.econd[e]);let e,t;for(let s in this.view.columns){if(t=-1!=["char","varchar","many2one","related"].indexOf(this.meta.columns[s].type)?"left":"right",e={text:this.meta.columns[s].label,value:s,align:"left",sortable:!0},"json"!=this.meta.columns[s].type&&this.headers.push(e),"json"!=this.meta.columns[s].type&&(this.fields.push(s),this.slot_names[s]="item."+s),"selection"==this.meta.columns[s].type||"referenced"==this.meta.columns[s].type&&"selection"==this.meta.columns[s].reftype){let e=[],t=this.meta.columns[s].selections;this.selectionFromForm[s]={};for(let i=0;i<t.length;i++)e.push({text:t[i].__tuple__[1],value:t[i].__tuple__[0]}),this.selectionFromForm[s][t[i].__tuple__[0]]=t[i].__tuple__[1];this.selectionFrom[s]=e}switch(this.meta.columns[s].type){case"many2one":case"related":this.$set(this.item,s,{id:null,name:null});break;case"one2many":case"many2many":this.$set(this.item,s,[]);break;default:this.$set(this.item,s,null)}}this.headers.push({text:"Actions",value:"action",sortable:!1})},selectItem(e){let t=this.meta.names.full_name?this.meta.names.full_name:this.meta.names.rec_name?this.meta.names.rec_name:"id",s={};switch(s.obj=this.obj,s.rel=this.rel,s.v={id:e.id,name:e[t],idx:this.idx,item:this.item_find},this.role){case"many2one-find":this.$websocket._components[this.obj].m2o_put(s.rel,s.v);break;case"related-find":this.$websocket._components[this.obj].related_put(s.rel,s.v);break;case"many2many-find":this.$websocket._components[this.obj].m2m_put(s.v.id)}this.dialog=!1},close(){this.$destroy(),this.$el.remove()},onLoadMeta:function(e){this.metas=e[0],this.meta=this.metas[this.model].meta,this.views=this.metas[this.model].views,"find"in this.views?this.view=this.views.find:this.view=this.views.list,this.name=this.meta.description,this.template=this.buildTemplate(),0==this.oids.length?this.send("onLoadData",["models",this.model,"select",{fields:this.fields,cond:this.cond,limit:80}]):this.send("onLoadData",["models",this.model,"readforupdate",{fields:this.fields,ids:this.oids}])},onLoadData:function(e){null==e&&(e=[]);for(let t=0;t<e.length;t++)for(let s in e[t])" "!=s&&"id"!=s&&-1!=["many2one","related"].indexOf(this.meta.columns[s].type)&&null==e[t][s]&&(e[t][s]={id:null,name:null});this.items=e},validateSearch:function(){this.cond=[];for(let e in this.search)switch(this.meta.columns[e].type){case"selection":null!=this.search[e]&&this.search[e].length>0&&(1==this.search[e].length?this.cond.push({__tuple__:[e,"=",this.search[e][0]]}):this.cond.push({__tuple__:[e,"in",this.search[e]]}));break;case"boolean":this.search[e]&&this.cond.push({__tuple__:[e]});break;default:null!=this.search[e]&&this.search[e].length>0&&this.cond.push({__tuple__:[e,"like",this.search[e]]})}this.send("onLoadData",["models",this.model,"select",{fields:this.fields,cond:this.cond,limit:this.limit}])}},created(){},mounted:function(){this.$websocket.registerComponent({n:`${this.$options.name}:${this._uid}`,c:this}),-1!=["many2one-find","form","related-find","many2many-find"].indexOf(this.role)&&this.send("onLoadMeta",["uis","get_meta_of_models_v2",{model:this.model,context:this.$root.context}])},beforeDestroy:function(){this.$websocket.unregisterComponent(`${this.$options.name}:${this._uid}`)}},n=s(19),a=Object(n.a)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-dialog",{ref:"sv",attrs:{scrollable:"","max-width":"980"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[s("v-card",[s("v-card-title",[s("span",{staticClass:"headline"},[e._v(e._s(e.title)+": "+e._s(e.name))])]),e._v(" "),s("v-card-text",[s("v-layout",{attrs:{column:"",id:"sv"}},[s("v-flex",[s("v-form",[s("v-layout",{attrs:{row:"","align-start":"","justify-start":"","fill-height":""}},[e._l(Object.keys(e.meta.columns),(function(t){return"selectable"in e.meta.columns[t]&&e.meta.columns[t].selectable||"selection"==e.meta.columns[t].type||null!=e.meta.names.inactive&&e.meta.names.inactive==t?["selection"==e.meta.columns[t].type?s("v-select",{attrs:{label:e.meta.columns[t].label,multiple:"",chips:"",hind:"Please select value","persistent-hint":"",items:e.selectionFrom[t]},model:{value:e.search[t],callback:function(s){e.$set(e.search,t,s)},expression:"search[column]"}}):"boolean"==e.meta.columns[t].type?s("v-checkbox",{attrs:{value:e.search[t],label:e.meta.columns[t].label,color:"indigo","hide-details":""},model:{value:e.search[t],callback:function(s){e.$set(e.search,t,s)},expression:"search[column]"}}):s("v-text-field",{attrs:{label:e.meta.columns[t].label},model:{value:e.search[t],callback:function(s){e.$set(e.search,t,s)},expression:"search[column]"}}),e._v(" "),s("v-spacer")]:e._e()})),e._v(" "),s("v-btn",{on:{click:e.validateSearch}},[s("v-icon",[e._v("search")])],1)],2)],1)],1),e._v(" "),s("v-flex",[s("v-btn",{attrs:{icon:"",text:"",color:"primary"},on:{click:function(t){return e.on_new_form(e.model)}}},[s("v-icon",[e._v("add_box")])],1),e._v(" "),s("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.selected.length>0,expression:"selected.length > 0"}],attrs:{icon:"",text:"",color:"blue"},on:{click:function(t){return e.lookupItem(e.model)}}},[s("v-icon",[e._v("remove_red_eye")])],1),e._v(" "),s("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.selected.length>0,expression:"selected.length > 0"}],attrs:{icon:"",text:"",color:"teal"},on:{click:function(t){return e.editItem(e.model)}}},[s("v-icon",[e._v("edit")])],1),e._v(" "),s("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.selected.length>0,expression:"selected.length > 0"}],attrs:{icon:"",text:"",color:"pink"},on:{click:function(t){return e.deleteItem(e.model)}}},[s("v-icon",[e._v("delete")])],1),e._v(" "),s("v-btn",{attrs:{text:"",icon:"",color:"indigo"},on:{click:function(t){return e.on_import_file(e.model)}}},[s("v-icon",[e._v("cloud_upload")])],1),e._v(" "),s("v-btn",{attrs:{text:"",icon:"",color:"indigo"},on:{click:function(t){return e.on_export_file(e.model)}}},[s("v-icon",[e._v("cloud_download")])],1),e._v(" "),s("v-card",[s("v-card-title",[s("v-text-field",{attrs:{label:"Limit",counter:"3",mask:"###"},model:{value:e.limit,callback:function(t){e.limit=e._n(t)},expression:"limit"}}),e._v(" "),s("v-spacer"),e._v(" "),s("v-spacer"),e._v(" "),s("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.find,callback:function(t){e.find=t},expression:"find"}})],1)],1),e._v(" "),s("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.items,"item-key":e.meta.names.rec_name?e.meta.names.rec_name:"id",search:e.find,"footer-props":e.footerprops,"single-select":!1,"show-select":""},scopedSlots:e._u([e._l(e.fields,(function(t){return{key:e.slot_names[t],fn:function(i){var l=i.item;return[["many2one","related"].indexOf(e.meta.columns[t].type)>=0?[e._v(e._s(l[t].name))]:"selection"==e.meta.columns[t].type?[e._v(e._s(e.selectionFromForm[t][l[t]]))]:"boolean"==e.meta.columns[t].type?[s("v-checkbox",{attrs:{disabled:"","hide-details":""},model:{value:l[t],callback:function(s){e.$set(l,t,s)},expression:"item[field]"}})]:"datetime"==e.meta.columns[t].type?[e._v(e._s(e._f("formatDatetime")(l[t])))]:"date"==e.meta.columns[t].type?[e._v(e._s(e._f("formatDate")(l[t])))]:"time"==e.meta.columns[t].type?[e._v(e._s(e._f("formatTime")(l[t])))]:"timedelta"==e.meta.columns[t].type?[e._v(e._s(e._f("formatTimedelta")(l[t])))]:"referenced"==e.meta.columns[t].type?[["many2one","related"].indexOf(e.meta.columns[t].reftype)>=0?[e._v(e._s(l[t].name))]:"selection"==e.meta.columns[t].reftype?[e._v(e._s(e.selectionFromForm[t][l[t]]))]:"boolean"==e.meta.columns[t].reftype?[s("v-checkbox",{attrs:{disabled:"","hide-details":""},model:{value:l[t],callback:function(s){e.$set(l,t,s)},expression:"item[field]"}})]:"datetime"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatDatetime")(l[t])))]:"date"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatDate")(l[t])))]:"time"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatTime")(l[t])))]:"timedelta"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatTimedelta")(l[t])))]:[e._v(e._s(l[t]))]]:[e._v(e._s(l[t]))]]}}})),{key:"item.action",fn:function(t){var i=t.item;return[s("v-btn",{staticClass:"mx-0",attrs:{icon:""},on:{click:function(t){return e.selectItem(i)}}},[s("v-icon",{attrs:{color:"blue"}},[e._v("check")])],1)]}}],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)],1)],1)],1)],1)}),[],!1,null,null,null);t.default=a.exports}}]);