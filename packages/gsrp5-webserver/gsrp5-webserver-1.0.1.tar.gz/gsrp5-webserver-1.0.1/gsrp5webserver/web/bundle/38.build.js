(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{483:function(e,t,s){"use strict";s.r(t);var i=s(1),n=s(10),l={name:"gsrp5-search-view",props:["metas","model","mode"],data:()=>({fields:[],meta:{},views:{},view:null,name:null,actions:{},active:null,menu:{},headers:[],items:[],selected:[],find:"",footerprops:{itemsPerPageOptions:[25,50,100,-1]},item:{},selectionFrom:{},selectionFromForm:{},c:{},d:{},m:{},search:{},slot_names:{},limit:80,cond:[]}),watch:{selected(e){this.$websocket.execute(`${this.$parent.$options.name}:${this.$parent._uid}`,"setselected",[this.selected])}},mixins:[{methods:{on_new_many2one:n.s,on_find_many2one:n.m,on_new_related:n.t,on_find_related:n.o,on_configure_view:n.g,readonly:n.v,required:n.z,visible:n.D,send:n.C}}],methods:{buildTemplate:function(){let e,t;for(let s in this.view.columns){if(t=-1!=["char","varchar","many2one","related"].indexOf(this.meta.columns[s].type)?"left":"right",e={text:this.meta.columns[s].label,value:s,align:t,sortable:!0},"json"!=this.meta.columns[s].type&&this.headers.push(e),"json"!=this.meta.columns[s].type&&(this.fields.push(s),this.slot_names[s]="item."+s),"selection"==this.meta.columns[s].type||"referenced"==this.meta.columns[s].type&&"selection"==this.meta.columns[s].reftype){let e=[],t=this.meta.columns[s].selections;this.selectionFromForm[s]={};for(let i=0;i<t.length;i++)e.push({text:t[i].__tuple__[1],value:t[i].__tuple__[0]}),this.selectionFromForm[s][t[i].__tuple__[0]]=t[i].__tuple__[1];this.selectionFrom[s]=e}switch(this.meta.columns[s].type){case"many2one":case"related":this.$set(this.item,s,{id:null,name:null});break;case"one2many":case"many2many":this.$set(this.item,s,[]);break;default:this.$set(this.item,s,null)}}this.headers.push({text:"Actions",value:"action",sortable:!1})},on_import_file(e){let t=document.querySelector("main.v-main"),s="upload_"+e.replace(/\./g,"_"),n=document.createElement("gsrp5-upload");n.id=s,document.querySelector("#sv").append(n);var l=e,o=t,a=n,c=this.$websocket;i.default.component("gsrp5-upload")().then((function(e){let t=new(i.default.extend(e.default));t.model=l,t.$websocket=c,t.$set(t,"$parent",o.__vue__),t.$mount("#"+a.id)}))},on_export_file(e){this.send("on_do_export_file",["models",this.model,"select",{fields:this.fields,cond:this.cond}])},on_do_export_file(e){let t="id,"+this.fields.join(",");t+="\n";let s=this;e.forEach((function(e){for(let t in e)if("id"!=t)switch(s.meta.columns[t].type){case"many2one":case"related":e[t]=e[t].name;break;case"selection":e[t]=s.selectionFromForm[t][e[t]]}t+=Object.values(e).join(","),t+="\n"}));let i=document.createElement("a");i.href="data:text/csv;charset=utf-8,"+encodeURI(t),i.target="_blank",i.download=this.model.replace(/\./g,"_")+".csv",i.click()},on_new_form(e){this.$websocket.execute(`${this.$parent.$options.name}:${this.$parent._uid}`,"settab",["gsrp5-form-view","new"])},lookupItem(e){this.$websocket.execute(`${this.$parent.$options.name}:${this.$parent._uid}`,"settab",["gsrp5-form-view","lookup"])},copyItem(e){this.$websocket.execute(`${this.$parent.$options.name}:${this.$parent._uid}`,"settab",["gsrp5-form-view","copy"])},editItem(e){this.$websocket.execute(`${this.$parent.$options.name}:${this.$parent._uid}`,"settab",["gsrp5-form-view","edit"])},deleteItem(e){if(this.selected.length>0){let e=[];for(let t=0;t<this.selected.length;t++)e.push(this.selected[t].id);e.length>0&&confirm("Are you sure you want to delete this item?")&&this.send("onDelete",["models",this.model,"unlink",{ids:e}])}},deleteItemSingle(e){this.items.indexOf(e),confirm("Are you sure you want to delete this item?")&&null!=e.id&&36==e.id.length&&this.send("onDeleteSingle",["models",this.model,"unlink",{ids:[e.id]}])},onDeleteSingle(e){if(this.send("ws-log",["_commit"]),e.length>0){let t=-1;for(let s=0;s<this.items.length;s++)this.items[s].id==e[0]&&(t=s);t>=0&&this.items.splice(t,1)}},m2o_new(e,t){this.$set(this.item,e,t)},m2o_put(e,t){this.$set(this.item,e,t)},related_new(e,t){this.$set(this.item,e,t)},related_put(e,t){this.$set(this.item,e,t)},onDelete(e){if(this.send(".ws-log",["_commit"]),e.length>0){let t=[];for(let s=0;s<this.items.length;s++)for(let i=0;i<e.length;i++)this.items[s].id==e[i]&&t.push(s);for(let e=t.length-1;e>=0;e--)this.items.splice(t[e],1)}},onLoadData:function(e){for(let t=0;t<e.length;t++)for(let s in e[t])" "!=s&&"id"!=s&&-1!=["many2one","related"].indexOf(this.meta.columns[s].type)&&null==e[t][s]&&(e[t][s]={id:null,name:null});this.items.splice(0,this.items.length,...e)},validateSearch:function(){this.cond=[];for(let e in this.search)switch(this.meta.columns[e].type){case"selection":null!=this.search[e]&&this.search[e].length>0&&(1==this.search[e].length?this.cond.push({__tuple__:[e,"=",this.search[e][0]]}):this.cond.push({__tuple__:[e,"in",this.search[e]]}));break;case"boolean":this.search[e]&&this.cond.push({__tuple__:[e]});break;default:null!=this.search[e]&&this.search[e].length>0&&this.cond.push({__tuple__:[e,"like",this.search[e]]})}this.send("onLoadData",["models",this.model,"select",{fields:this.fields,cond:this.cond,limit:this.limit}])}},created:function(){this.$websocket.registerComponent({n:`${this.$options.name}:${this._uid}`,c:this})},mounted:function(){this.meta=this.metas[this.model].meta,this.views=this.metas[this.model].views,this.view=this.views.search,this.name=this.meta.description,this.actions=this.meta.actions,this.fields=Object.keys(this.view.columns),this.template=this.buildTemplate(),this.send("onLoadData",["models",this.model,"select",{fields:this.fields,cond:this.cond,limit:80}])},beforeDestroy:function(){this.$websocket.unregisterComponent(`${this.$options.name}:${this._uid}`)}},o=s(19),a=Object(o.a)(l,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return"columns"in e.meta?s("v-layout",{attrs:{column:"",id:"sv"}},[e._v(e._s(e.name)+"\n\t  "),s("v-flex",[s("v-form",[s("v-layout",{attrs:{row:"","align-start":"","justify-start":"","fill-height":""}},[e._l(Object.keys(e.meta.columns),(function(t){return"selectable"in e.meta.columns[t]&&e.meta.columns[t].selectable||"selection"==e.meta.columns[t].type||null!=e.meta.names.inactive&&e.meta.names.inactive==t?["selection"==e.meta.columns[t].type?s("v-select",{attrs:{label:e.meta.columns[t].label,multiple:"",chips:"",hind:"Please select value","persistent-hint":"",items:e.selectionFrom[t]},model:{value:e.search[t],callback:function(s){e.$set(e.search,t,s)},expression:"search[column]"}}):"boolean"==e.meta.columns[t].type?s("v-checkbox",{attrs:{value:e.search[t],label:e.meta.columns[t].label,color:"indigo","hide-details":""},model:{value:e.search[t],callback:function(s){e.$set(e.search,t,s)},expression:"search[column]"}}):s("v-text-field",{attrs:{label:e.meta.columns[t].label},model:{value:e.search[t],callback:function(s){e.$set(e.search,t,s)},expression:"search[column]"}}),e._v(" "),s("v-spacer")]:e._e()})),e._v(" "),s("v-btn",{on:{click:e.validateSearch}},[s("v-icon",[e._v("search")])],1)],2)],1)],1),e._v(" "),s("v-flex",{attrs:{xs:"8",sm:"8",md:"8",lg:"8",xl:"8"}},[s("v-btn",{attrs:{icon:"",color:"primary"},on:{click:function(t){return e.on_new_form(e.model)}}},[s("v-icon",[e._v("add_box")])],1),e._v(" "),s("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.selected.length>0,expression:"selected.length > 0"}],attrs:{icon:"",color:"blue"},on:{click:function(t){return e.lookupItem(e.model)}}},[s("v-icon",[e._v("remove_red_eye")])],1),e._v(" "),s("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.selected.length>0,expression:"selected.length > 0"}],attrs:{icon:"",color:"yellow"},on:{click:function(t){return e.copyItem(e.model)}}},[s("v-icon",[e._v("store")])],1),e._v(" "),s("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.selected.length>0,expression:"selected.length > 0"}],attrs:{icon:"",color:"teal"},on:{click:function(t){return e.editItem(e.model)}}},[s("v-icon",[e._v("edit")])],1),e._v(" "),s("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.selected.length>0,expression:"selected.length > 0"}],attrs:{icon:"",color:"pink"},on:{click:function(t){return e.deleteItem(e.model)}}},[s("v-icon",[e._v("delete")])],1),e._v(" "),s("v-btn",{attrs:{icon:"",color:"indigo"},on:{click:function(t){return e.on_import_file(e.model)}}},[s("v-icon",[e._v("cloud_upload")])],1),e._v(" "),s("v-btn",{attrs:{icon:"",color:"indigo"},on:{click:function(t){return e.on_export_file(e.model)}}},[s("v-icon",[e._v("cloud_download")])],1),e._v(" "),s("v-btn",{attrs:{icon:"",color:"purple"},on:{click:function(t){return e.on_configure_view(e.model)}}},[s("v-icon",[e._v("settings")])],1),e._v(" "),s("v-card",[s("v-card-title",[s("v-text-field",{attrs:{label:"Limit",counter:"3",mask:"###"},model:{value:e.limit,callback:function(t){e.limit=e._n(t)},expression:"limit"}}),e._v(" "),s("v-spacer"),e._v(" "),s("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.find,callback:function(t){e.find=t},expression:"find"}})],1)],1),e._v(" "),s("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.items,"footer-props":e.footerprops,"single-select":!1,"show-select":"","item-key":e.meta.names.rec_name?e.meta.names.rec_name:"id",search:e.find},scopedSlots:e._u([e._l(e.fields,(function(t){return{key:e.slot_names[t],fn:function(i){var n=i.item;return[["many2one","related"].indexOf(e.meta.columns[t].type)>=0?[e._v(e._s(n[t].name))]:"selection"==e.meta.columns[t].type?[e._v(e._s(e.selectionFromForm[t][n[t]]))]:"boolean"==e.meta.columns[t].type?[s("v-simple-checkbox",{attrs:{disabled:"","hide-details":""},model:{value:n[t],callback:function(s){e.$set(n,t,s)},expression:"item[field]"}})]:"datetime"==e.meta.columns[t].type?[e._v(e._s(e._f("formatDatetime")(n[t])))]:"date"==e.meta.columns[t].type?[e._v(e._s(e._f("formatDate")(n[t])))]:"time"==e.meta.columns[t].type?[e._v(e._s(e._f("formatTime")(n[t])))]:"timedelta"==e.meta.columns[t].type?[e._v(e._s(e._f("formatTimedelta")(n[t])))]:"referenced"==e.meta.columns[t].type?[["many2one","related"].indexOf(e.meta.columns[t].reftype)>=0?[e._v(e._s(n[t].name))]:"selection"==e.meta.columns[t].reftype?[e._v(e._s(e.selectionFromForm[t][n[t]]))]:"boolean"==e.meta.columns[t].reftype?[s("v-simple-checkbox",{attrs:{disabled:"","hide-details":""},model:{value:n[t],callback:function(s){e.$set(n,t,s)},expression:"item[field]"}})]:"datetime"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatDatetime")(n[t])))]:"date"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatDate")(n[t])))]:"time"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatTime")(n[t])))]:"timedelta"==e.meta.columns[t].reftype?[e._v(e._s(e._f("formatTimedelta")(n[t])))]:[e._v(e._s(n[t]))]]:[e._v(e._s(n[t]))]]}}})),{key:"item.action",fn:function(t){var i=t.item;return[s("v-btn",{staticClass:"mx-0",attrs:{icon:""},on:{click:function(t){return e.deleteItemSingle(i)}}},[s("v-icon",{attrs:{color:"pink"}},[e._v("delete")])],1)]}}],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)],1):e._e()}),[],!1,null,null,null);t.default=a.exports}}]);