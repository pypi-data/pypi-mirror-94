(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{505:function(e,t,i){"use strict";i.r(t);var s=i(10),a={name:"gsrp5-configure-view",props:["model","view","title"],mixins:[{methods:{cache:s.a,on_cache:s.f,send:s.C,on_modify_models:s.r}}],data:()=>({metas:null,meta:null,item:null,guid:null,oid:null,dialog:!0,selected1:[],find1:"",footerprops1:{itemsPerPageOptions:[25,50,100,-1]},headers1:[{text:"Show Columns",value:"col",align:"left",sortable:!0}],items1:[],selected2:[],find2:"",footerprops2:{itemsPerPageOptions:[25,50,100,-1]},headers2:[{text:"Avaiable Columns",value:"col",align:"left",sortable:!0}],items2:[],valid:!0,m:{},c:{},d:{}}),methods:{dataRowContainer(e,t){for(let i in e){i+"."+t in this.c||this.$set(this.c,i+"."+t,e[i]);for(let t=0;t<e[i].length;t++)this.dataRow(e[i][t])}},dataRow(e){"__data__"in e&&this.$set(this.d,e.__path__,e.__data__),"__meta__"in e&&this.$set(this.m,e.__path__,e.__meta__),"__m2m_containers__"in e&&this.dataRowContainer(e.__m2m_containers__,e.__path__),"__o2m_containers__"in e&&this.dataRowContainer(e.__o2m_containers__,e.__path__)},onInitialize(e){this.$set(this,"item",e[0]),this.dataRow(this.item),this.item.__data__.view.id=this.view.id,this.item.__data__.view.name=this.view.viewname,this.cache(this.item,"view"),this.item.__data__.tuser.id=this.$root.user,this.cache(this.item,"tuser");for(let e=0,t=Object.keys(this.view.columns);e<t.length;e++)this.items1.push({col:t[e]})},onLoadMeta(e){this.$set(this,"metas",e[0]),this.$set(this,"meta",this.metas["bc.tuning.ui.views"].meta),this.send("onSearch",["models","bc.tuning.ui.views","search",{cond:[{__tuple__:["view","=",this.view.viewname]}],context:{}}])},onOpen(e){null==this.guid&&(this.guid=e[0]),this.send("onLoadMeta",["uis","get_meta_of_models_v2",{model:"bc.tuning.ui.views",context:this.$root.context}])},onSearch(e){0==e.length?this.send("onInitialize",["_cache","initialize",this.guid,{model:"bc.tuning.ui.views",view:"form"}]):this.send("onRead",["models","bc.tuning.ui.views","readforupdate",{fields:["name","view","tuser","fullname","values"],ids:e[0],context:{cache:this.guid}}])},onRead(e){if(e.length>0){let t=e[0].__data__.values?e[0].__data__.values:[],i=[],s=Object.keys(this.view.columns);if(this.oid=e[0].__data__.id,0==t.length)for(let e=0;e<s.length;e++)t.push({seq:e,col:s[e]});for(let e=0;e<t.length;e++)i.push(t[e].col);for(let e=0;e<s.length;e++)i.indexOf(s[e])<0&&this.items2.push({col:s[e]});for(let e=0;e<i.length;e++)this.items1.push({col:i[e]});this.$set(this,"item",e[0]),this.dataRow(this.item)}},on_add(){for(let e=0;e<this.selected2.length;e++)this.items1.push(this.selected2[e]);for(let e,t=0;t<this.selected2.length;t++)(e=this.items2.indexOf(this.selected2[t]))>=0&&this.items2.splice(e,1);this.item.__data__.values=[];for(let e=0;e<this.items1.length;e++)this.item.__data__.values.push({seq:e,col:this.items1[e].col});let e={path:item.__path__,key:values,value:this.item.__data__.values,context:{}};this.send("on_value_cache",["_cache","cache",this.guid,e])},on_value_cache(e){console.log("on_cache:",e)},on_remove(){for(let e=0;e<this.selected1.length;e++)this.items2.push(this.selected1[e]);for(let e,t=0;t<this.selected1.length;t++)(e=this.items1.indexOf(this.selected1[t]))>=0&&this.items1.splice(e,1);this.item.__data__.values=[];for(let e=0;e<this.items1.length;e++)this.item.__data__.values.push({seq:e,col:this.items1[e].col});let e={path:this.item.__path__,key:"values",value:this.item.__data__.values,context:{}};this.send("on_cache",["_cache","cache",this.guid,e])},close(){this.$destroy(),this.$el.remove(),this.dialog=!1},save(){this.send("onSave",["_cache","save",this.guid,{}])},onSave(e){"commit"==e[0]&&this.send("onCommit",["_cache","commit",this.guid,{action:"commit work"}])},onCommit(){this.close(),this.$snotify.info("Record saved.")}},mounted(){this.$websocket.registerComponent({n:`${this.$options.name}:${this._uid}`,c:this}),this.send("onOpen",["_cache","open",{mode:"edit",context:{}}])},beforeDestroy:function(){this.$websocket.unregisterComponent(`${this.$options.name}:${this._uid}`)}},l=i(19),n=Object(l.a)(a,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-dialog",{attrs:{scrollable:"",persistent:"","max-width":"980"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[i("v-card",[i("v-card-title",[e._v("View Columns Configure: "+e._s(e.title))]),e._v(" "),i("v-card-text",[null!=e.item?i("v-form",{ref:"form",attrs:{"lazy-validation":!0},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[i("v-text-field",{attrs:{label:"Name",required:!0,clearable:"",counter:"1024"},on:{change:function(t){return e.cache(e.item,"name")}},model:{value:e.item.__data__.name,callback:function(t){e.$set(e.item.__data__,"name",t)},expression:"item.__data__.name"}}),e._v(" "),i("v-text-field",{attrs:{label:"Name",required:!0,clearable:"",counter:"1024"},on:{change:function(t){return e.cache(e.item,"fullname")}},model:{value:e.item.__data__.fullname,callback:function(t){e.$set(e.item.__data__,"fullname",t)},expression:"item.__data__.fullname"}}),e._v(" "),i("v-text-field",{attrs:{label:"View",readonly:!0},model:{value:e.item.__data__.view.name,callback:function(t){e.$set(e.item.__data__.view,"name",t)},expression:"item.__data__.view.name"}})],1):e._e(),e._v(" "),i("v-layout",{attrs:{rows:""}},[i("v-flex",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers1,items:e.items1,"item-key":"col",search:e.find1,"footer-props":e.footerprops1,"single-select":!1,"show-select":""},model:{value:e.selected1,callback:function(t){e.selected1=t},expression:"selected1"}})],1),e._v(" "),i("v-flex",[i("v-btn",{attrs:{color:"green"},on:{click:e.on_add}},[e._v("Add")]),e._v(" "),i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"red"},on:{click:e.on_remove}},[e._v("Remove")])],1),e._v(" "),i("v-flex",[i("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers2,items:e.items2,"item-key":"col",search:e.find2,"footer-props":e.footerprops2,"single-select":!1,"show-select":""},model:{value:e.selected2,callback:function(t){e.selected2=t},expression:"selected2"}})],1)],1)],1),e._v(" "),i("v-card-actions",[i("v-spacer"),e._v(" "),i("v-btn",{attrs:{color:"blue darken-1"},nativeOn:{click:function(t){return e.close(t)}}},[e._v("Cancel")]),e._v(" "),i("v-btn",{attrs:{color:"green darken-1"},nativeOn:{click:function(t){return e.save(t)}}},[e._v("Save")])],1)],1)],1)}),[],!1,null,null,null);t.default=n.exports}}]);