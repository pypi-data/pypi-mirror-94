(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{490:function(e,t,s){"use strict";s.r(t);var i=s(10),n=s(420),r=s.n(n),a={name:"gsrp5-mdx-view",props:["metas","model"],data:()=>({data:[],fields:[],colFields:[],rowFields:[],reducer:function(e,t){return e+1},selectionFrom:{},selectionFromForm:{},vfields:[],rfields:[],rfield:null,aggregates:[{text:"Count",value:"count"},{text:"Sum",value:"sum"},{text:"Average",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"}],aggregate:"sum",template:null}),mixins:[{methods:{send:i.C,on_configure_view:i.g}}],components:{Pivot:r.a,PivotTable:r.a},watch:{rfield(e,t){switch(this.aggregate){case"count":this.$set(this,"reducer",new Function("count","item","return count + 1"));break;case"sum":this.$set(this,"reducer",new Function("sum","item","return sum + item."+e));break;case"avg":this.$set(this,"reducer",new Function("avg","item","return (avg + item."+e+")/2"));break;case"min":this.$set(this,"reducer",new Function("min","item","return min < item ? min : item."+e));break;case"max":this.$set(this,"reducer",new Function("max","item","return max > item ? max : item."+e))}},aggregate(e,t){switch(e){case"count":this.$set(this,"reducer",new Function("count","item","return count + 1"));break;case"sum":this.$set(this,"reducer",new Function("sum","item","return sum + item."+this.rfield));break;case"avg":this.$set(this,"reducer",new Function("avg","item","return (avg + item."+this.rfield+")/2"));break;case"min":this.$set(this,"reducer",new Function("min","item","return min < item ? min : item."+this.rfield));break;case"max":this.$set(this,"reducer",new Function("max","item","return max > item ? max : item."+this.rfield))}}},methods:{onMDX:function(e){e.length>0&&this.$set(this,"data",e)}},mounted(){this.meta=this.metas[this.model].meta,this.views=this.metas[this.model].views,this.view=this.views.mdx,this.name=this.meta.description,this.actions=this.meta.actions;let e=[],t=[];this.view_variants=this.view.confs.map((function(e){return e.name})),this.selected_view_variant=this.view_variants[0],this.show_cols=this.view.confs[0].values.map((function(e){return e.col}));var s=this.show_cols;this.show_cols.length>0?this.vfields=Object.keys(this.view.columns).filter((function(e){return s.indexOf(e)>=0})):this.vfields=Object.keys(this.view.columns);for(let s=0;s<this.vfields.length;s++)switch(this.meta.columns[this.vfields[s]].type){case"char":case"varchar":this.vfields[s]==this.meta.names.rec_name?this.colFields.push({label:this.meta.columns[this.vfields[s]].label,getter:new Function("item","return item."+this.vfields[s])}):this.rowFields.push({label:this.meta.columns[this.vfields[s]].label,getter:new Function("item","return item."+this.vfields[s])});break;case"date":case"time":case"datatime":case"text":case"xml":this.rowFields.push({label:this.meta.columns[this.vfields[s]].label,getter:new Function("item","return item."+this.vfields[s])});break;case"many2one":case"related":this.rowFields.push({label:this.meta.columns[this.vfields[s]].label,getter:new Function("item","return item."+this.vfields[s]+".name")});break;case"selection":this.selectionFromForm[this.vfields[s]]={},t=this.meta.columns[this.vfields[s]].selections;for(let i=0;i<t.length;i++)e.push({text:t[i][1],value:t[i][0]}),this.selectionFromForm[this.vfields[s]][t[i][0]]=t[i][1];this.selectionFrom[this.vfields[s]]=e,this.rowFields.push({label:this.meta.columns[this.vfields[s]].label,getter:new Function("item","return item."+this.vfields[s])});break;case"integer":case"float":case"double":case"real":case"decimal":case"numeric":this.rfields.push(this.vfields[s]);break;default:this.rowFields.push({label:this.meta.columns[this.vfields[s]].label,getter:new Function("item","return item."+this.vfields[s])})}this.rfield=this.rfields[0],this.reducer=new Function("sum","item","return sum + item."+this.rfield),this.send("onMDX",["models",this.model,"select",{fields:this.vfields}])},created:function(){this.$websocket.registerComponent({n:`${this.$options.name}:${this._uid}`,c:this})},beforeDestroy:function(){this.$websocket.unregisterComponent(`${this.$options.name}:${this._uid}`)}},l=s(19),m=Object(l.a)(a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{xs1:"",sm1:"",md1:"",lg1:"",xl1:""}},[s("v-btn",{attrs:{icon:"",color:"purple"},on:{click:function(t){return e.on_configure_view(e.model)}}},[s("v-icon",[e._v("settings")])],1)],1),e._v(" "),s("v-flex",{attrs:{xs2:"",sm2:"",md2:"",lg2:"",xl2:""}},[s("v-select",{attrs:{label:"Criteria",items:e.rfields},model:{value:e.rfield,callback:function(t){e.rfield=t},expression:"rfield"}})],1),e._v(" "),s("v-flex",{attrs:{xs1:"",sm1:"",md1:"",lg1:"",xl1:""}}),e._v(" "),s("v-flex",{attrs:{xs2:"",sm2:"",md2:"",lg2:"",xl2:""}},[s("v-select",{attrs:{label:"Aggregate",items:e.aggregates},model:{value:e.aggregate,callback:function(t){e.aggregate=t},expression:"aggregate"}})],1)],1),e._v(" "),s("pivot",{ref:"pivot",attrs:{data:e.data,fields:e.fields,"row-fields":e.rowFields,"col-fields":e.colFields,reducer:e.reducer}})],1)}),[],!1,null,null,null);t.default=m.exports}}]);