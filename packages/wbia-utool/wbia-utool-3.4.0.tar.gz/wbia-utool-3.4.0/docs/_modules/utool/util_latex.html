
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>utool.util_latex &#8212; wbia-vtool 3.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for utool.util_latex</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">TODO: box and whisker</span>
<span class="sd">http://tex.stackexchange.com/questions/115210/boxplot-in-latex</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">zip</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">dirname</span>  <span class="c1"># NOQA</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="k">import</span> <span class="n">util_num</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="k">import</span> <span class="n">util_inject</span>

<span class="nb">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">util_inject</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># def ensure_latex_environ():</span>
<span class="c1">#    paths = os.environ[&#39;PATH&#39;].split(os.pathsep)</span>
<span class="c1">#    mpl.rc(&#39;font&#39;,**{&#39;family&#39;:&#39;serif&#39;})</span>
<span class="c1">#    mpl.rc(&#39;text&#39;, usetex=True)</span>
<span class="c1">#    mpl.rc(&#39;text.latex&#39;,unicode=True)</span>
<span class="c1">#    mpl.rc(&#39;text.latex&#39;,preamble=&#39;\usepackage[utf8]{inputenc}&#39;)</span>


<div class="viewcode-block" id="find_ghostscript_exe"><a class="viewcode-back" href="../../utool.html#utool.util_latex.find_ghostscript_exe">[docs]</a><span class="k">def</span> <span class="nf">find_ghostscript_exe</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">WIN32</span><span class="p">:</span>
        <span class="n">gs_exe</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Program Files (x86)\gs\gs9.16\bin\gswin32c.exe&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gs_exe</span> <span class="o">=</span> <span class="s1">&#39;gs&#39;</span>
    <span class="k">return</span> <span class="n">gs_exe</span></div>


<div class="viewcode-block" id="compress_pdf"><a class="viewcode-back" href="../../utool.html#utool.util_latex.compress_pdf">[docs]</a><span class="k">def</span> <span class="nf">compress_pdf</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">output_fname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; uses ghostscript to write a pdf &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">assertpath</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">)</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_datestamp</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_compressed&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pdf_fpath = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,))</span>
    <span class="n">output_pdf_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">augpath</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">newfname</span><span class="o">=</span><span class="n">output_fname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;output_pdf_fpath = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">output_pdf_fpath</span><span class="p">,))</span>
    <span class="n">gs_exe</span> <span class="o">=</span> <span class="n">find_ghostscript_exe</span><span class="p">()</span>
    <span class="n">cmd_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">gs_exe</span><span class="p">,</span>
        <span class="s1">&#39;-sDEVICE=pdfwrite&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-dCompatibilityLevel=1.4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-dNOPAUSE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-dQUIET&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-dBATCH&#39;</span><span class="p">,</span>
        <span class="s1">&#39;-sOutputFile=&#39;</span> <span class="o">+</span> <span class="n">output_pdf_fpath</span><span class="p">,</span>
        <span class="n">pdf_fpath</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="o">*</span><span class="n">cmd_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_pdf_fpath</span></div>


<div class="viewcode-block" id="make_full_document"><a class="viewcode-back" href="../../utool.html#utool.util_latex.make_full_document">[docs]</a><span class="k">def</span> <span class="nf">make_full_document</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preamp_decl</span><span class="o">=</span><span class="p">{},</span> <span class="n">preamb_extra</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dummy preamble and document to wrap around latex fragment</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>
<span class="sd">        title (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: text_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-make_full_document</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;foo&#39;</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;title&#39;</span>
<span class="sd">        &gt;&gt;&gt; preamp_decl = {}</span>
<span class="sd">        &gt;&gt;&gt; text_ = make_full_document(text, title)</span>
<span class="sd">        &gt;&gt;&gt; result = str(text_)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">doc_preamb</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    %\\documentclass{article}</span>
<span class="sd">    \\documentclass[10pt,twocolumn,letterpaper]{article}</span>
<span class="sd">    % \\usepackage[utf8]{inputenc}</span>
<span class="sd">    \\usepackage[T1]{fontenc}</span>

<span class="sd">    \\usepackage{times}</span>
<span class="sd">    \\usepackage{epsfig}</span>
<span class="sd">    \\usepackage{graphicx}</span>
<span class="sd">    \\usepackage{amsmath,amsthm,amssymb}</span>
<span class="sd">    \\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}</span>
<span class="sd">    \\usepackage{multirow}</span>
<span class="sd">    \\usepackage{subcaption}</span>
<span class="sd">    \\usepackage{booktabs}</span>

<span class="sd">    %\\pagenumbering{gobble}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">preamb_extra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">preamb_extra</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">preamb_extra</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">preamb_extra</span><span class="p">)</span>
        <span class="n">doc_preamb</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">preamb_extra</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">preamp_decl</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>

    <span class="n">decl_lines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">r</span><span class="s1">&#39;\</span><span class="si">{key}</span><span class="s1">{{</span><span class="si">{val}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">preamp_decl</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="n">doc_decllines</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decl_lines</span><span class="p">)</span>

    <span class="n">doc_header</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        \begin{document}</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">preamp_decl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">doc_header</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;\maketitle&#39;</span>

    <span class="n">doc_footer</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        \end{document}</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">doc_preamb</span><span class="p">,</span> <span class="n">doc_decllines</span><span class="p">,</span> <span class="n">doc_header</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">doc_footer</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">text_</span></div>


<div class="viewcode-block" id="render_latex_text"><a class="viewcode-back" href="../../utool.html#utool.util_latex.render_latex_text">[docs]</a><span class="k">def</span> <span class="nf">render_latex_text</span><span class="p">(</span>
    <span class="n">input_text</span><span class="p">,</span> <span class="n">nest_in_doc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preamb_extra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s1">&#39;utool&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; compiles latex and shows the result &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">VERBOSE</span>
    <span class="n">dpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_app_resource_dir</span><span class="p">(</span><span class="n">appname</span><span class="p">,</span> <span class="s1">&#39;latex_tmp&#39;</span><span class="p">)</span>
    <span class="c1"># put a latex framgent in a full document</span>
    <span class="c1"># print(input_text)</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;temp_render_latex&#39;</span>
    <span class="n">pdf_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compile_latex_text</span><span class="p">(</span>
        <span class="n">input_text</span><span class="p">,</span> <span class="n">dpath</span><span class="o">=</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">preamb_extra</span><span class="o">=</span><span class="n">preamb_extra</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
    <span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pdf_fpath</span></div>


<div class="viewcode-block" id="compile_latex_text"><a class="viewcode-back" href="../../utool.html#utool.util_latex.compile_latex_text">[docs]</a><span class="k">def</span> <span class="nf">compile_latex_text</span><span class="p">(</span>
    <span class="n">input_text</span><span class="p">,</span>
    <span class="n">dpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">move</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">nest_in_doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">preamb_extra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-compile_latex_text --show</span>

<span class="sd">    Ignore:</span>
<span class="sd">        pdflatex -shell-escape --synctex=-1 -src-specials -interaction=nonstopmode\</span>
<span class="sd">            ~/code/ibeis/tmptex/latex_formatter_temp.tex</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; #dpath = &#39;/home/joncrall/code/ibeis/aidchallenge&#39;</span>
<span class="sd">        &gt;&gt;&gt; dpath = dirname(ut.grab_test_imgpath())</span>
<span class="sd">        &gt;&gt;&gt; #ut.vd(dpath)</span>
<span class="sd">        &gt;&gt;&gt; orig_fpaths = ut.list_images(dpath, fullpath=True)</span>
<span class="sd">        &gt;&gt;&gt; figure_str = ut.get_latex_figure_str(orig_fpaths, width_str=&#39;2.4in&#39;, nCols=2)</span>
<span class="sd">        &gt;&gt;&gt; input_text = figure_str</span>
<span class="sd">        &gt;&gt;&gt; pdf_fpath = ut.compile_latex_text(input_text, dpath=dpath,</span>
<span class="sd">        &gt;&gt;&gt;                                   verbose=verbose)</span>
<span class="sd">        &gt;&gt;&gt; output_pdf_fpath = ut.compress_pdf(pdf_fpath)</span>
<span class="sd">        &gt;&gt;&gt; print(pdf_fpath)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; ut.startfile(pdf_fpath)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ut] compile_latex_text&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">nest_in_doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nest_in_doc</span> <span class="o">=</span> <span class="s1">&#39;documentclass&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_text</span>
    <span class="k">if</span> <span class="n">nest_in_doc</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">make_full_document</span><span class="p">(</span><span class="n">input_text</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">preamb_extra</span><span class="o">=</span><span class="n">preamb_extra</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dpath</span><span class="p">:</span>
        <span class="n">dpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;temp_latex&#39;</span>

    <span class="c1"># Create temporary work directly</span>
    <span class="n">work_dpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="s1">&#39;.tmptex&#39;</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">work_dpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">fname_tex</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_ext</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;.tex&#39;</span><span class="p">)</span>
    <span class="n">fname_pdf</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_ext</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">tex_fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">work_dpath</span><span class="p">,</span> <span class="n">fname_tex</span><span class="p">)</span>
    <span class="n">pdf_fpath_output</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">work_dpath</span><span class="p">,</span> <span class="n">fname_pdf</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">write_to</span><span class="p">(</span><span class="n">tex_fpath</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">ut</span><span class="o">.</span><span class="n">ChdirContext</span><span class="p">(</span><span class="n">work_dpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># print(text)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s1">&#39;lualatex&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-shell-escape&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--synctex=-1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-src-specials&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-interaction=nonstopmode&#39;</span><span class="p">,</span>
                <span class="n">tex_fpath</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cmd2</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">pdf_fpath_output</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error compiling LaTeX&#39;</span><span class="p">)</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">print_code</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;latex&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;latex failed &#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">move</span><span class="p">:</span>
        <span class="n">pdf_fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">fname_pdf</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">pdf_fpath_output</span><span class="p">,</span> <span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pdf_fpath</span> <span class="o">=</span> <span class="n">pdf_fpath_output</span>
    <span class="k">return</span> <span class="n">pdf_fpath</span></div>


<div class="viewcode-block" id="convert_pdf_to_image"><a class="viewcode-back" href="../../utool.html#utool.util_latex.convert_pdf_to_image">[docs]</a><span class="k">def</span> <span class="nf">convert_pdf_to_image</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ut] convert_pdf_to_image.&#39;</span><span class="p">)</span>
    <span class="n">img_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_ext</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">UNIX</span><span class="p">:</span>
        <span class="n">convert_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cmd2</span><span class="p">(</span><span class="s1">&#39;which convert&#39;</span><span class="p">)[</span><span class="s1">&#39;out&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">convert_fpath</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ImageMagik convert was not found&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;convert&#39;</span><span class="p">,</span> <span class="s1">&#39;-density&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dpi</span><span class="p">),</span> <span class="n">pdf_fpath</span><span class="p">,</span> <span class="s1">&#39;-quality&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">quality</span><span class="p">),</span> <span class="n">img_fpath</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cmd2</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># NOQA</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">img_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to convert pdf to &#39;</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ImageMagik failed to convert pdf to &#39;</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img_fpath</span></div>


<div class="viewcode-block" id="render_latex"><a class="viewcode-back" href="../../utool.html#utool.util_latex.render_latex">[docs]</a><span class="k">def</span> <span class="nf">render_latex</span><span class="p">(</span>
    <span class="n">input_text</span><span class="p">,</span> <span class="n">dpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preamb_extra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Renders latex text into a jpeg.</span>

<span class="sd">    Whitespace that would have appeared in the PDF is removed, so the jpeg is</span>
<span class="sd">    cropped only the the relevant part.  This is ideal for figures that only</span>
<span class="sd">    take a single page.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_text (?):</span>
<span class="sd">        dpath (str):  directory path(default = None)</span>
<span class="sd">        fname (str):  file name(default = None)</span>
<span class="sd">        preamb_extra (None): (default = None)</span>
<span class="sd">        verbose (int):  verbosity flag(default = 1)</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: jpg_fpath -  file path string</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex render_latex &#39;$O(n^2)$&#39; --fpath=~/slides/tmp.jpg</span>

<span class="sd">    Script:</span>
<span class="sd">        &gt;&gt;&gt; # SCRIPT</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; from os.path import split, expanduser</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; input_text = &#39; &#39;.join(ut.get_varargs()[1:])</span>
<span class="sd">        &gt;&gt;&gt; dpath, fname = split(ut.argval(&#39;--fpath&#39;, &#39;&#39;))</span>
<span class="sd">        &gt;&gt;&gt; dpath = expanduser(ut.argval(&#39;--dpath&#39;, dpath))</span>
<span class="sd">        &gt;&gt;&gt; fname = ut.argval(&#39;--fname&#39;, fname)</span>
<span class="sd">        &gt;&gt;&gt; kwargs = ut.dict_subset(ut.argparse_funckw(ut.convert_pdf_to_image), [&#39;dpi&#39;, &#39;quality&#39;])</span>
<span class="sd">        &gt;&gt;&gt; jpg_fpath = render_latex(input_text, dpath, fname, **kwargs)</span>
<span class="sd">        &gt;&gt;&gt; if ut.argflag(&#39;--diskshow&#39;):</span>
<span class="sd">        &gt;&gt;&gt;     ut.startfile(jpg_fpath)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">vtool</span> <span class="k">as</span> <span class="nn">vt</span>
    <span class="c1"># turn off page numbers</span>
    <span class="n">input_text_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">pagenumbering</span><span class="si">{gobble}</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">input_text</span>
    <span class="c1"># fname, _ = splitext(fname)</span>
    <span class="n">img_fname</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">ensure_ext</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;.jpg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">IMG_EXTENSIONS</span><span class="p">))</span>
    <span class="n">img_fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span> <span class="n">img_fname</span><span class="p">)</span>
    <span class="n">pdf_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compile_latex_text</span><span class="p">(</span>
        <span class="n">input_text_</span><span class="p">,</span>
        <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span>
        <span class="n">dpath</span><span class="o">=</span><span class="n">dpath</span><span class="p">,</span>
        <span class="n">preamb_extra</span><span class="o">=</span><span class="n">preamb_extra</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">move</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">img_fname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">fpath_in</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">convert_pdf_to_image</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># Clip of boundaries of the pdf imag</span>
    <span class="n">vt</span><span class="o">.</span><span class="n">clipwhite_ondisk</span><span class="p">(</span><span class="n">fpath_in</span><span class="p">,</span> <span class="n">fpath_out</span><span class="o">=</span><span class="n">img_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img_fpath</span></div>


<div class="viewcode-block" id="latex_multicolumn"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_multicolumn">[docs]</a><span class="k">def</span> <span class="nf">latex_multicolumn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alignstr</span><span class="o">=</span><span class="s1">&#39;|c|&#39;</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;\multicolumn{</span><span class="si">%d</span><span class="s1">}{</span><span class="si">%s</span><span class="s1">}{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">alignstr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="latex_multirow"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_multirow">[docs]</a><span class="k">def</span> <span class="nf">latex_multirow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;\multirow{</span><span class="si">%d</span><span class="s1">}{*}{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="latex_get_stats"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_get_stats">[docs]</a><span class="k">def</span> <span class="nf">latex_get_stats</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">stats_</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stats_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;empty_list&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;% NA: latex_get_stats, data=[]&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">stat_keys</span> <span class="o">=</span> <span class="n">stats_</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># NOQA</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stat_keys&#39;</span><span class="p">,</span> <span class="s1">&#39;stats_&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="k">raise</span>

    <span class="c1"># int_fmt = lambda num: util.num_fmt(int(num))</span>
    <span class="k">def</span> <span class="nf">float_fmt</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">util_num</span><span class="o">.</span><span class="n">num_fmt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">tup_fmt</span><span class="p">(</span><span class="n">tup</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>

    <span class="n">fmttup</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">float_fmt</span><span class="p">(</span><span class="n">min_</span><span class="p">),</span>
        <span class="n">float_fmt</span><span class="p">(</span><span class="n">max_</span><span class="p">),</span>
        <span class="n">float_fmt</span><span class="p">(</span><span class="n">mean</span><span class="p">),</span>
        <span class="n">float_fmt</span><span class="p">(</span><span class="n">std</span><span class="p">),</span>
        <span class="n">tup_fmt</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">lll</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prefmtstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{label}</span><span class="s2"> stats &amp; min ; max = </span><span class="si">%s</span><span class="s2"> ; </span><span class="si">%s</span><span class="s2">\\</span>
<span class="s2">        </span><span class="si">{space}</span><span class="s2">       &amp; mean; std = </span><span class="si">%s</span><span class="s2"> ; </span><span class="si">%s</span><span class="s2">\\</span>
<span class="s2">        </span><span class="si">{space}</span><span class="s2">       &amp; shape = </span><span class="si">%s</span><span class="s2"> \\&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">prefmtstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{label}</span><span class="s2"> stats &amp; min  = $</span><span class="si">%s</span><span class="s2">$\\</span>
<span class="s2">        </span><span class="si">{space}</span><span class="s2">       &amp; max  = $</span><span class="si">%s</span><span class="s2">$\\</span>
<span class="s2">        </span><span class="si">{space}</span><span class="s2">       &amp; mean = $</span><span class="si">%s</span><span class="s2">$\\</span>
<span class="s2">        </span><span class="si">{space}</span><span class="s2">       &amp; std  = $</span><span class="si">%s</span><span class="s2">$\\</span>
<span class="s2">        </span><span class="si">{space}</span><span class="s2">       &amp; shape = $</span><span class="si">%s</span><span class="s2">$\\&quot;&quot;&quot;</span>
    <span class="n">fmtstr</span> <span class="o">=</span> <span class="n">prefmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">lll</span><span class="p">)</span>
    <span class="n">latex_str</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">fmtstr</span> <span class="o">%</span> <span class="n">fmttup</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">latex_str</span></div>


<div class="viewcode-block" id="latex_scalar"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_scalar">[docs]</a><span class="k">def</span> <span class="nf">latex_scalar</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &amp; </span><span class="si">%s</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">util_num</span><span class="o">.</span><span class="n">num_fmt</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></div>


<div class="viewcode-block" id="make_stats_tabular"><a class="viewcode-back" href="../../utool.html#utool.util_latex.make_stats_tabular">[docs]</a><span class="k">def</span> <span class="nf">make_stats_tabular</span><span class="p">():</span>
    <span class="s1">&#39;tabular for dipslaying statistics&#39;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ensure_rowvec"><a class="viewcode-back" href="../../utool.html#utool.util_latex.ensure_rowvec">[docs]</a><span class="k">def</span> <span class="nf">ensure_rowvec</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="ensure_colvec"><a class="viewcode-back" href="../../utool.html#utool.util_latex.ensure_colvec">[docs]</a><span class="k">def</span> <span class="nf">ensure_colvec</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="escape_latex"><a class="viewcode-back" href="../../utool.html#utool.util_latex.escape_latex">[docs]</a><span class="k">def</span> <span class="nf">escape_latex</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        text (str): a plain text message</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: the message escaped to appear correctly in LaTeX</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/16259923/how-can-i-escape-characters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;&amp;&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\&amp;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;%&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\%&#39;</span><span class="p">,</span>
        <span class="s1">&#39;$&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\$&#39;</span><span class="p">,</span>
        <span class="s1">&#39;#&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\#&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\_&#39;</span><span class="p">,</span>
        <span class="s1">&#39;{&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\{&#39;</span><span class="p">,</span>
        <span class="s1">&#39;}&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\}&#39;</span><span class="p">,</span>
        <span class="s1">&#39;~&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\textasciitilde</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;^&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\^</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\textbackslash</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\textless&#39;</span><span class="p">,</span>
        <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\textgreater&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="kn">import</span> <span class="nn">six</span>

    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">conv</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="n">conv</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()],</span> <span class="n">text</span><span class="p">)</span></div>


<div class="viewcode-block" id="replace_all"><a class="viewcode-back" href="../../utool.html#utool.util_latex.replace_all">[docs]</a><span class="k">def</span> <span class="nf">replace_all</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">repltups</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">str_</span>
    <span class="k">for</span> <span class="n">ser</span><span class="p">,</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">repltups</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">rep</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="make_score_tabular"><a class="viewcode-back" href="../../utool.html#utool.util_latex.make_score_tabular">[docs]</a><span class="k">def</span> <span class="nf">make_score_tabular</span><span class="p">(</span>
    <span class="n">row_lbls</span><span class="p">,</span>
    <span class="n">col_lbls</span><span class="p">,</span>
    <span class="n">values</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">out_of</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bold_best</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">flip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">bigger_is_better</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">multicol_lbls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">FORCE_INT</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">SHORTEN_ROW_LBLS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">col_align</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">,</span>
    <span class="n">col_sep</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span>
    <span class="n">multicol_sep</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span>
    <span class="n">centerline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">astable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">table_position</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">AUTOFIX_LATEX</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makes a LaTeX tabular for displaying scores or errors</span>

<span class="sd">    Args:</span>
<span class="sd">        row_lbls (list of str):</span>
<span class="sd">        col_lbls (list of str):</span>
<span class="sd">        values (ndarray):</span>
<span class="sd">        title (str):  (default = None)</span>
<span class="sd">        out_of (None): (default = None)</span>
<span class="sd">        bold_best (bool): (default = True)</span>
<span class="sd">        flip (bool): (default = False)</span>
<span class="sd">        table_position (str) : eg &#39;[h]&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: tabular_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-make_score_tabular:0 --show</span>
<span class="sd">        python -m utool.util_latex --test-make_score_tabular:1 --show</span>
<span class="sd">        python -m utool.util_latex --test-make_score_tabular:2 --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; row_lbls = [&#39;config1&#39;, &#39;config2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; col_lbls = [&#39;score \leq 1&#39;, &#39;metric2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; values = np.array([[1.2, 2], [3.2, 4]])</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;title&#39;</span>
<span class="sd">        &gt;&gt;&gt; out_of = 10</span>
<span class="sd">        &gt;&gt;&gt; bold_best = True</span>
<span class="sd">        &gt;&gt;&gt; flip = False</span>
<span class="sd">        &gt;&gt;&gt; tabular_str = make_score_tabular(row_lbls, col_lbls, values, title, out_of, bold_best, flip)</span>
<span class="sd">        &gt;&gt;&gt; result = tabular_str</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; render_latex_text(tabular_str)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; row_lbls = [&#39;config1&#39;]</span>
<span class="sd">        &gt;&gt;&gt; col_lbls = [&#39;score \leq 1&#39;, &#39;metric2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; values = np.array([[1.2, 2]])</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;title&#39;</span>
<span class="sd">        &gt;&gt;&gt; out_of = 10</span>
<span class="sd">        &gt;&gt;&gt; bold_best = True</span>
<span class="sd">        &gt;&gt;&gt; flip = False</span>
<span class="sd">        &gt;&gt;&gt; tabular_str = make_score_tabular(row_lbls, col_lbls, values, title, out_of, bold_best, flip)</span>
<span class="sd">        &gt;&gt;&gt; result = tabular_str</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; render_latex_text(tabular_str)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; row_lbls = [&#39;config1&#39;, &#39;config2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; col_lbls = [&#39;score \leq 1&#39;, &#39;metric2&#39;, &#39;foobar&#39;]</span>
<span class="sd">        &gt;&gt;&gt; multicol_lbls = [(&#39;spam&#39;, 1), (&#39;eggs&#39;, 2)]</span>
<span class="sd">        &gt;&gt;&gt; values = np.array([[1.2, 2, -3], [3.2, 4, -2]])</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;title&#39;</span>
<span class="sd">        &gt;&gt;&gt; out_of = 10</span>
<span class="sd">        &gt;&gt;&gt; bold_best = True</span>
<span class="sd">        &gt;&gt;&gt; flip = False</span>
<span class="sd">        &gt;&gt;&gt; tabular_str = make_score_tabular(row_lbls, col_lbls, values, title, out_of, bold_best, flip, multicol_lbls=multicol_lbls)</span>
<span class="sd">        &gt;&gt;&gt; result = tabular_str</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; render_latex_text(tabular_str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">flip</span><span class="p">:</span>
        <span class="n">bigger_is_better</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">bigger_is_better</span>
        <span class="n">flip_repltups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">leq&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">gt&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">geq&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">lt&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">col_lbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">replace_all</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">flip_repltups</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">col_lbls</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">replace_all</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">flip_repltups</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out_of</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">out_of</span> <span class="o">-</span> <span class="n">values</span>

    <span class="c1"># Abbreviate based on common substrings</span>
    <span class="n">common_rowlbl</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">SHORTEN_ROW_LBLS</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">row_lbl_list</span> <span class="o">=</span> <span class="n">row_lbls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row_lbl_list</span> <span class="o">=</span> <span class="n">row_lbls</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># Split the rob labels into the alg components</span>
        <span class="c1"># algcomp_list = [lbl.split(&#39;)_&#39;) for lbl in row_lbl_list]</span>
        <span class="n">longest</span> <span class="o">=</span> <span class="n">long_substr</span><span class="p">(</span><span class="n">row_lbl_list</span><span class="p">)</span>
        <span class="n">common_strs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">longest</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">common_strs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">longest</span><span class="p">]</span>
            <span class="n">row_lbl_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">longest</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">row_lbl_list</span><span class="p">]</span>
            <span class="n">longest</span> <span class="o">=</span> <span class="n">long_substr</span><span class="p">(</span><span class="n">row_lbl_list</span><span class="p">)</span>
        <span class="n">common_rowlbl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common_strs</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)_&#39;</span><span class="p">,</span> <span class="s1">&#39;)_</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">row_lbls</span> <span class="o">=</span> <span class="n">row_lbl_list</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_lbl_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">common_rowlbl</span> <span class="o">=</span> <span class="n">row_lbl_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">row_lbls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span>

    <span class="c1"># Stack values into a tabular body</span>
    <span class="c1"># TODO: need ability to specify datatypes</span>
    <span class="k">def</span> <span class="nf">ensurelist</span><span class="p">(</span><span class="n">row_values</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">row_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">row_values</span>

    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="c1"># Numpy formatting</span>
        <span class="k">def</span> <span class="nf">padvec</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s1">&#39; &#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
            <span class="k">return</span> <span class="n">pad</span>

        <span class="n">col_lbls</span> <span class="o">=</span> <span class="n">ensure_rowvec</span><span class="p">(</span><span class="n">col_lbls</span><span class="p">)</span>
        <span class="n">row_lbls</span> <span class="o">=</span> <span class="n">ensure_colvec</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">)</span>
        <span class="n">_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">padvec</span><span class="p">(),</span> <span class="n">row_lbls</span><span class="p">])</span>
        <span class="n">_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">col_lbls</span><span class="p">,</span> <span class="n">values</span><span class="p">])</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">_0</span><span class="p">,</span> <span class="n">_1</span><span class="p">])</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[[</span><span class="n">str_</span> <span class="k">for</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">body</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39; &#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">col_lbls</span><span class="p">]</span>
        <span class="n">body</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">row_lbl</span><span class="p">]</span> <span class="o">+</span> <span class="n">ensurelist</span><span class="p">(</span><span class="n">row_values</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row_lbl</span><span class="p">,</span> <span class="n">row_values</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="c1"># import utool as ut</span>
    <span class="c1"># Fix things in each body cell</span>
    <span class="n">DO_PERCENT</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="c1"># In data land</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># Hack</span>
                        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]):</span>
                            <span class="n">fmtstr</span> <span class="o">=</span> <span class="s1">&#39;%.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                            <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmtstr</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]),)</span>
                    <span class="c1"># Force integer</span>
                    <span class="k">if</span> <span class="n">FORCE_INT</span><span class="p">:</span>
                        <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])))</span>
                <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
                <span class="c1"># Remove bad formatting;</span>
                <span class="k">if</span> <span class="n">AUTOFIX_LATEX</span><span class="p">:</span>
                    <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(row_lbls) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">),))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(col_lbls) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_lbls</span><span class="p">),))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(values) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">values</span><span class="p">,))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ut.depth_profile(values) = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">values</span><span class="p">),))</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
        <span class="k">raise</span>

    <span class="c1"># Bold the best values</span>
    <span class="k">if</span> <span class="n">bold_best</span><span class="p">:</span>
        <span class="n">best_col_scores</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">bigger_is_better</span> <span class="k">else</span> <span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rows_to_bold</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">values</span><span class="p">[:,</span> <span class="n">colx</span><span class="p">]</span> <span class="o">==</span> <span class="n">best_col_scores</span><span class="p">[</span><span class="n">colx</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">colx</span><span class="p">,</span> <span class="n">rowx_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows_to_bold</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">rowx</span> <span class="ow">in</span> <span class="n">rowx_list</span><span class="p">:</span>
                <span class="n">body</span><span class="p">[</span><span class="n">rowx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">colx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">txtbf{&#39;</span> <span class="o">+</span> <span class="n">body</span><span class="p">[</span><span class="n">rowx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">colx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>

    <span class="c1"># More fixing after the bold is in place</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="c1"># In data land</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">out_of</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_of</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">DO_PERCENT</span><span class="p">:</span>
                        <span class="n">percent</span> <span class="o">=</span> <span class="s1">&#39; = </span><span class="si">%.1f%%</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">out_of</span><span class="p">)</span>
                        <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span>

    <span class="c1"># Align columns for pretty printing</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">ALIGN_BODY</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">ALIGN_BODY</span><span class="p">:</span>
        <span class="n">new_body_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">colstrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ensurelist</span><span class="p">(</span><span class="n">col</span><span class="p">)))</span>
            <span class="n">collens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">colstrs</span><span class="p">))</span>
            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">collens</span><span class="p">)</span>
            <span class="n">newcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">str_</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_</span><span class="p">)))</span> <span class="k">for</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">colstrs</span><span class="p">]</span>
            <span class="n">new_body_cols</span> <span class="o">+=</span> <span class="p">[</span><span class="n">newcols</span><span class="p">]</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_body_cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># Build Body (and row layout)</span>
    <span class="n">HLINE_SEP</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">rowvalsep</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">colvalsep</span> <span class="o">=</span> <span class="s1">&#39; &amp; &#39;</span>
    <span class="n">endl</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span>
    <span class="n">hline</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\hline&#39;</span>
    <span class="c1"># extra_rowsep_pos_list = [1]  # rows to insert an extra hline after</span>
    <span class="n">extra_rowsep_pos_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># rows to insert an extra hline after</span>
    <span class="k">if</span> <span class="n">HLINE_SEP</span><span class="p">:</span>
        <span class="n">rowvalsep</span> <span class="o">=</span> <span class="n">hline</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="c1"># rowstr list holds blocks of rows</span>
    <span class="n">rowstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">colvalsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">+</span> <span class="n">endl</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">body</span><span class="p">]</span>
    <span class="c1"># rowstr_list = [row[0] + rowlbl_sep + colvalsep.join(row[1:]) + endl for row in body]</span>
    <span class="c1"># rowstr_list = [(</span>
    <span class="c1">#    (&#39;&#39; if len(row) == 0 else row[0])</span>
    <span class="c1">#    if len(row) &lt;= 1 else</span>
    <span class="c1">#    row[0] + rowlblcol_sep + colvalsep.join(row[1:]) + endl)</span>
    <span class="c1">#    for row in body]</span>
    <span class="n">rowsep_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">rowvalsep</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rowstr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">]</span>  <span class="c1"># should be len 1 less than rowstr_list</span>
    <span class="c1"># Insert multicolumn names</span>
    <span class="k">if</span> <span class="n">multicol_lbls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># TODO: label of the row labels</span>
        <span class="n">multicol_sep</span>
        <span class="n">multicols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">latex_multicolumn</span><span class="p">(</span><span class="n">multicol</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="n">multicol_sep</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">multicol</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">multicol_lbls</span>
        <span class="p">]</span>
        <span class="n">multicol_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">latex_multirow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">colvalsep</span> <span class="o">+</span> <span class="n">colvalsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">multicols</span><span class="p">)</span> <span class="o">+</span> <span class="n">endl</span>
        <span class="p">)</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">multicol_lbls</span><span class="p">])</span>
        <span class="n">mcol_sep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">cline{2-</span><span class="si">%d</span><span class="s1">}</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ncols</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span>
        <span class="n">rowstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">multicol_str</span><span class="p">]</span> <span class="o">+</span> <span class="n">rowstr_list</span>
        <span class="n">rowsep_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">mcol_sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">rowsep_list</span>
        <span class="c1"># extra_rowsep_pos_list += [1]</span>

    <span class="c1"># Insert title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">astable</span><span class="p">:</span>
        <span class="n">tex_title</span> <span class="o">=</span> <span class="n">latex_multicolumn</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">endl</span>
        <span class="n">rowstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tex_title</span><span class="p">]</span> <span class="o">+</span> <span class="n">rowstr_list</span>
        <span class="n">rowsep_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">rowvalsep</span><span class="p">]</span> <span class="o">+</span> <span class="n">rowsep_list</span>
        <span class="c1"># extra_rowsep_pos_list += [2]</span>

    <span class="c1"># Apply an extra hline (for label)</span>
    <span class="c1"># extra_rowsep_pos_list = []</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">extra_rowsep_pos_list</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">rowstr_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">rowsep_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">rowvalsep</span><span class="p">)</span>
    <span class="c1"># tabular_body = rowvalsep.join(rowstr_list)</span>
    <span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="n">zip_longest</span>

    <span class="n">tabular_body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">row</span> <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">row</span> <span class="o">+</span> <span class="n">sep</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">sep</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">rowstr_list</span><span class="p">,</span> <span class="n">rowsep_list</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Build Column Layout</span>
    <span class="n">col_align_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_align</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># extra_collayoutsep_pos_list = [1]</span>
    <span class="n">extra_collayoutsep_pos_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">extra_collayoutsep_pos_list</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">col_align_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># col_layaout_sep_list = rowlblcol_sep  # TODO</span>

    <span class="n">rowlblcol_sep</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span>
    <span class="c1"># Build build internal seprations between column alignments</span>
    <span class="c1"># Defaults to just the normal col_sep</span>
    <span class="n">col_align_sep_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_sep</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_align_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Adjust for the separations between row labels and the actual row data</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_align_sep_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">col_align_sep_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rowlblcol_sep</span>
    <span class="c1"># Continue multicolumn sepratation</span>
    <span class="k">if</span> <span class="n">multicol_lbls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">multicol_offsets</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">multicol_lbls</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">multicol_offsets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_align_sep_list</span><span class="p">):</span>
                <span class="n">col_align_sep_list</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">multicol_sep</span>

    <span class="kn">from</span> <span class="nn">six.moves</span> <span class="k">import</span> <span class="n">zip_longest</span>

    <span class="n">_tmp</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">filter_Nones</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">col_align_list</span><span class="p">,</span> <span class="n">col_align_sep_list</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">col_layout</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">_tmp</span><span class="p">))</span>

    <span class="c1"># if len(col_align_list) &gt; 1:</span>
    <span class="c1">#    col_layout = col_align_list[0] + rowlblcol_sep + col_sep.join(col_align_list[1:])</span>
    <span class="c1"># else:</span>
    <span class="c1">#    col_layout = col_sep.join(col_align_list)</span>

    <span class="n">tabular_head</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\begin</span><span class="si">{tabular}</span><span class="s1">{|</span><span class="si">%s</span><span class="s1">|}&#39;</span> <span class="o">%</span> <span class="n">col_layout</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">tabular_tail</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\end</span><span class="si">{tabular}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">centerline</span><span class="p">:</span>
        <span class="n">tabular_head</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\centerline{&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">tabular_head</span>
        <span class="n">tabular_tail</span> <span class="o">=</span> <span class="n">tabular_tail</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>

    <span class="k">if</span> <span class="n">astable</span><span class="p">:</span>
        <span class="c1"># tabular_head = r&#39;\begin{centering}&#39; + &#39;\n&#39; + tabular_head</span>
        <span class="n">tabular_head</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\centering&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">tabular_head</span>
        <span class="n">tabular_head</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\begin</span><span class="si">{table}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">table_position</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">tabular_head</span>

        <span class="n">lblstr</span> <span class="o">=</span> <span class="n">latex_sanitize_command_name</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>
        <span class="n">caption</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">if</span> <span class="n">AUTOFIX_LATEX</span><span class="p">:</span>
            <span class="n">caption</span> <span class="o">=</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">caption</span><span class="p">)</span>
        <span class="n">caption</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">% ---</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">caption</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">% ---</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="c1"># tabular_head = r&#39;\end{centering}&#39; + &#39;\n&#39; + tabular_head</span>
        <span class="n">tabular_tail</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">tabular_tail</span>
            <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">\caption[</span><span class="si">%s</span><span class="s1">]{</span><span class="si">%s</span><span class="s1">}</span><span class="se">\n</span><span class="s1">\label{tbl:</span><span class="si">%s</span><span class="s1">}</span><span class="se">\n</span><span class="s1">\end</span><span class="si">{table}</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">lblstr</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="n">lblstr</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">tabular_str</span> <span class="o">=</span> <span class="n">rowvalsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tabular_head</span><span class="p">,</span> <span class="n">tabular_body</span><span class="p">,</span> <span class="n">tabular_tail</span><span class="p">])</span>
    <span class="n">topsep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">hline</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="kc">True</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">toprule</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">botsep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">hline</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="kc">True</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">bottomrule</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">tabular_str</span> <span class="o">=</span> <span class="n">tabular_head</span> <span class="o">+</span> <span class="n">topsep</span> <span class="o">+</span> <span class="n">tabular_body</span> <span class="o">+</span> <span class="n">botsep</span> <span class="o">+</span> <span class="n">tabular_tail</span>

    <span class="k">if</span> <span class="n">common_rowlbl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># tabular_str += escape_latex(&#39;\n\nThe following parameters were held fixed:\n&#39; + common_rowlbl)</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">tabular_str</span></div>


<div class="viewcode-block" id="get_latex_figure_str2"><a class="viewcode-back" href="../../utool.html#utool.util_latex.get_latex_figure_str2">[docs]</a><span class="k">def</span> <span class="nf">get_latex_figure_str2</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="n">cmdname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; hack for candidacy &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>
    <span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">relpath</span>

    <span class="c1"># Make relative paths</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;relpath&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="s1">&#39;~/latex/crall-candidacy-2015&#39;</span><span class="p">)</span>
        <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">relpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">]</span>
    <span class="n">cmdname</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">latex_sanitize_command_name</span><span class="p">(</span><span class="n">cmdname</span><span class="p">)</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;caption_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;caption_str&#39;</span><span class="p">,</span> <span class="n">cmdname</span><span class="p">)</span>
    <span class="n">figure_str</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_latex_figure_str</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">latex_block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">latex_newcommand</span><span class="p">(</span><span class="n">cmdname</span><span class="p">,</span> <span class="n">figure_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">latex_block</span></div>


<div class="viewcode-block" id="get_latex_figure_str"><a class="viewcode-back" href="../../utool.html#utool.util_latex.get_latex_figure_str">[docs]</a><span class="k">def</span> <span class="nf">get_latex_figure_str</span><span class="p">(</span>
    <span class="n">fpath_list</span><span class="p">,</span>
    <span class="n">caption_str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">label_str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">width_str</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\textwidth&#39;</span><span class="p">,</span>
    <span class="n">height_str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nCols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colpos_sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
    <span class="n">nlsep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">use_sublbls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_frame</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fpath_list (list):</span>
<span class="sd">        dpath (str): directory relative to main tex file</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: figure_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-get_latex_figure_str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; fpath_list = [&#39;figures/foo.png&#39;]</span>
<span class="sd">        &gt;&gt;&gt; figure_str = get_latex_figure_str(fpath_list)</span>
<span class="sd">        &gt;&gt;&gt; result = str(figure_str)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">nCols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nCols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>

    <span class="n">USE_SUBFIGURE</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">width_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colwidth</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">nCols</span>
        <span class="k">if</span> <span class="n">USE_SUBFIGURE</span><span class="p">:</span>
            <span class="n">colwidth</span> <span class="o">*=</span> <span class="mf">0.95</span>
            <span class="n">graphics_sizestr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colwidth</span><span class="p">,))</span> <span class="o">+</span> <span class="n">width_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graphics_sizestr</span> <span class="o">=</span> <span class="s1">&#39;[width=</span><span class="si">%.1f%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colwidth</span><span class="p">,</span> <span class="n">width_str</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">height_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graphics_sizestr</span> <span class="o">=</span> <span class="s1">&#39;[height=</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">height_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">graphics_sizestr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">dpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">relpath_unix</span><span class="p">(</span><span class="n">fpath_</span><span class="p">,</span> <span class="n">dpath</span><span class="p">)</span> <span class="k">for</span> <span class="n">fpath_</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">USE_SUBFIGURE</span><span class="p">:</span>
        <span class="c1"># References: https://en.wikibooks.org/wiki/LaTeX/Floats,_Figures_and_Captions#Subfloats</span>
        <span class="c1"># TODO ? http://tex.stackexchange.com/questions/159290/how-can-i-place-a-vertical-rule-between-subfigures</span>
        <span class="c1"># Use subfigures</span>
        <span class="n">graphics_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sublbl_prefix</span> <span class="o">=</span> <span class="n">label_str</span> <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            print(&#39;, &#39;.join([str(x) + &#39;:&#39; + chr(x) for x in range(65, 123)]))</span>
<span class="sd">            print(&#39;, &#39;.join([str(x) + &#39;:&#39; + chr(x) for x in range(97, 123)]))</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">CHRLBLS</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">CHRLBLS</span><span class="p">:</span>
                <span class="c1"># subchar = chr(97 + count)</span>
                <span class="n">subchar</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subchar</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">subfigure_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin</span><span class="si">{subfigure}</span><span class="s1">[h]{&#39;</span> <span class="o">+</span> <span class="n">graphics_sizestr</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">centering&#39;</span><span class="p">)</span>
            <span class="n">graphics_part</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">includegraphics[width=</span><span class="si">%s</span><span class="s1">]{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">width_str</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,)</span>
            <span class="k">if</span> <span class="n">use_frame</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">fbox{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">graphics_part</span><span class="p">,))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graphics_part</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_sublbls</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">use_sublbls</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">caption</span><span class="si">{}</span><span class="se">\\</span><span class="s1">label{sub:&#39;</span> <span class="o">+</span> <span class="n">sublbl_prefix</span> <span class="o">+</span> <span class="n">subchar</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{subfigure}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">subfigure_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
            <span class="n">graphics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfigure_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">graphics_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">r</span><span class="s1">&#39;\includegraphics</span><span class="si">%s</span><span class="s1">{</span><span class="si">%s</span><span class="s1">}\captionof</span><span class="si">{figure}</span><span class="s1">{</span><span class="si">%s</span><span class="s1">}&#39;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="n">graphics_sizestr</span><span class="p">,</span>
                    <span class="n">fpath</span><span class="p">,</span>
                    <span class="s1">&#39;fd&#39;</span><span class="p">,</span>
                    <span class="c1">#&#39;(&#39; + str(count) + &#39;)&#39;</span>
                    <span class="c1">#&#39;(&#39; + chr(97 + count) + &#39;)&#39;</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graphics_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">r</span><span class="s1">&#39;\includegraphics</span><span class="si">%s</span><span class="s1">{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">graphics_sizestr</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,)</span>
                <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span>
            <span class="p">]</span>
        <span class="c1"># graphics_list = [r&#39;\includegraphics%s{%s}&#39; % (graphics_sizestr, fpath,) ]</span>
    <span class="c1"># nRows = len(graphics_list) // nCols</span>

    <span class="c1"># Add separators</span>
    <span class="n">NL</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">USE_SUBFIGURE</span><span class="p">:</span>
        <span class="n">col_spacer_mid</span> <span class="o">=</span> <span class="n">NL</span> <span class="o">+</span> <span class="s1">&#39;~~&#39;</span> <span class="o">+</span> <span class="s1">&#39;% --&#39;</span> <span class="o">+</span> <span class="n">NL</span>
        <span class="n">col_spacer_end</span> <span class="o">=</span> <span class="n">NL</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;% --&#39;</span> <span class="o">+</span> <span class="n">NL</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">col_spacer_mid</span> <span class="o">=</span> <span class="n">NL</span> <span class="o">+</span> <span class="s1">&#39;&amp;&#39;</span> <span class="o">+</span> <span class="n">NL</span>
        <span class="n">col_spacer_end</span> <span class="o">=</span> <span class="n">NL</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">nlsep</span> <span class="o">+</span> <span class="n">NL</span>
    <span class="n">sep_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">col_spacer_mid</span> <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="n">nCols</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">col_spacer_end</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">graphics_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sep_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sep_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">graphics_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">graphstr</span> <span class="o">+</span> <span class="n">sep</span> <span class="k">for</span> <span class="n">graphstr</span><span class="p">,</span> <span class="n">sep</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">graphics_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">)]</span>

    <span class="c1"># graphics_body = &#39;\n&amp;\n&#39;.join(graphics_list)</span>
    <span class="n">graphics_body</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphics_list_</span><span class="p">)</span>
    <span class="n">header_str</span> <span class="o">=</span> <span class="n">colpos_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nCols</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">USE_SUBFIGURE</span><span class="p">:</span>
        <span class="n">figure_body</span> <span class="o">=</span> <span class="n">graphics_body</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">figure_body</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
                <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            \begin{tabular}{%s}</span>
<span class="sd">            %s</span>
<span class="sd">            \end{tabular}</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">header_str</span><span class="p">,</span> <span class="n">graphics_body</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">caption_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># tabular_body += &#39;\n\caption{\\footnotesize{%s}}&#39; % (caption_str,)</span>
        <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figure_body</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">\caption[</span><span class="si">%s</span><span class="s1">]{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">caption_str</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">figure_body</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">\caption{</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caption_str</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figure_body</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">\label{fig:</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label_str</span><span class="p">,)</span>
    <span class="c1"># figure_fmtstr = ut.codeblock(</span>
    <span class="c1">#    r&#39;&#39;&#39;</span>
    <span class="c1">#    \begin{figure*}</span>
    <span class="c1">#    \begin{center}</span>
    <span class="c1">#    %s</span>
    <span class="c1">#    \end{center}</span>
    <span class="c1">#    \end{figure*}</span>
    <span class="c1">#    &#39;&#39;&#39;</span>
    <span class="c1"># )</span>
    <span class="n">figure_fmtstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        \begin{figure}[ht!]</span>
<span class="sd">        \centering</span>
<span class="sd">        %s</span>
<span class="sd">        \end{figure}</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">figure_str</span> <span class="o">=</span> <span class="n">figure_fmtstr</span> <span class="o">%</span> <span class="p">(</span><span class="n">figure_body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">figure_str</span></div>


<div class="viewcode-block" id="long_substr"><a class="viewcode-back" href="../../utool.html#utool.util_latex.long_substr">[docs]</a><span class="k">def</span> <span class="nf">long_substr</span><span class="p">(</span><span class="n">strlist</span><span class="p">):</span>
    <span class="c1"># Longest common substring</span>
    <span class="c1"># http://stackoverflow.com/questions/2892931/longest-common-substring-from-more-than-two-strings-python</span>
    <span class="n">substr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">substr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_substr</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">],</span> <span class="n">strlist</span><span class="p">):</span>
                    <span class="n">substr</span> <span class="o">=</span> <span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">substr</span></div>


<div class="viewcode-block" id="is_substr"><a class="viewcode-back" href="../../utool.html#utool.util_latex.is_substr">[docs]</a><span class="k">def</span> <span class="nf">is_substr</span><span class="p">(</span><span class="n">find</span><span class="p">,</span> <span class="n">strlist</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">find</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">find</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">strlist</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="tabular_join"><a class="viewcode-back" href="../../utool.html#utool.util_latex.tabular_join">[docs]</a><span class="k">def</span> <span class="nf">tabular_join</span><span class="p">(</span><span class="n">tabular_body_list</span><span class="p">,</span> <span class="n">nCols</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">dedent</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span>
    <span class="n">tabular_head</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    \begin{tabular}{|l|l|}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">tabular_tail</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    \end{tabular}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">hline</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;\hline&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">])</span>
    <span class="n">tabular_body</span> <span class="o">=</span> <span class="n">hline</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tabular_body_list</span><span class="p">)</span>
    <span class="n">tabular</span> <span class="o">=</span> <span class="n">hline</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tabular_head</span><span class="p">,</span> <span class="n">tabular_body</span><span class="p">,</span> <span class="n">tabular_tail</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tabular</span></div>


<div class="viewcode-block" id="latex_newcommand"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_newcommand">[docs]</a><span class="k">def</span> <span class="nf">latex_newcommand</span><span class="p">(</span><span class="n">command_name</span><span class="p">,</span> <span class="n">command_text</span><span class="p">,</span> <span class="n">num_args</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">newcmd_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">newcommand{</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">command_name</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
    <span class="k">if</span> <span class="n">num_args</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s1">&#39;[</span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_args</span><span class="p">,)</span>
    <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s1">&#39;{&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">command_text</span><span class="p">:</span>
        <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="n">command_text</span>
    <span class="k">if</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">command_text</span><span class="p">:</span>
        <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s1">&#39;}&#39;</span>
    <span class="k">return</span> <span class="n">newcmd_str</span></div>


<div class="viewcode-block" id="latex_sanitize_command_name"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_sanitize_command_name">[docs]</a><span class="k">def</span> <span class="nf">latex_sanitize_command_name</span><span class="p">(</span><span class="n">_cmdname</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        _cmdname (?):</span>

<span class="sd">    Returns:</span>
<span class="sd">        ?: command_name</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --exec-latex_sanitize_command_name</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; _cmdname = &#39;#foo bar.&#39;</span>
<span class="sd">        &gt;&gt;&gt; command_name = latex_sanitize_command_name(_cmdname)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;command_name = %s&#39; % (str(command_name),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        FooBar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>

    <span class="n">command_name</span> <span class="o">=</span> <span class="n">_cmdname</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">subroman</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">roman</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">groupdict</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">groupdict</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="k">return</span> <span class="n">roman</span><span class="o">.</span><span class="n">toRoman</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;groupdict&#39;</span><span class="p">])</span>
                <span class="k">raise</span>

        <span class="n">command_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">named_field</span><span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">),</span> <span class="n">subroman</span><span class="p">,</span> <span class="n">command_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">SUPER_STRICT</span><span class="p">:</span>
            <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="k">raise</span>
    <span class="c1"># remove numbers</span>
    <span class="n">command_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\d&#39;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;#()[]</span><span class="si">{}</span><span class="s1">.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">command_name</span><span class="p">)</span>
    <span class="c1"># Remove _ for camel case</span>
    <span class="c1"># def to_camel_case(str_list):</span>
    <span class="c1">#    # hacky</span>
    <span class="c1">#    return &#39;&#39;.join([str_ if len(str_) &lt; 1 else str_[0].upper() + str_[1:] for str_ in str_list])</span>
    <span class="c1"># command_name = to_cammel_case(re.split(&#39;[_ ]&#39;, command_name)[::2])</span>
    <span class="n">str_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[_ ]&#39;</span><span class="p">,</span> <span class="n">command_name</span><span class="p">)</span>
    <span class="c1"># command_name = to_cammel_case(str_list)</span>
    <span class="n">command_name</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">to_camel_case</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">),</span> <span class="n">mixed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">command_name</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex</span>
<span class="sd">        python -m utool.util_latex --allexamples</span>
<span class="sd">        python -m utool.util_latex --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>

    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c1"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="k">as</span> <span class="nn">ut</span>  <span class="c1"># NOQA</span>

    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">wbia-vtool</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../utool.html">utool package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../utool.html">utool</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Wild Me.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>