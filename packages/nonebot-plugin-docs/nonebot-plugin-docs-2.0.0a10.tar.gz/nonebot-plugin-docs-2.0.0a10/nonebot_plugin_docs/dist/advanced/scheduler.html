<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>定时任务 | NoneBot</title>
    <meta name="description" content="">
    <link rel="icon" href="/docs/logo.png">
    <link rel="manifest" href="/docs/manifest.json">
    <link rel="apple-touch-icon" href="/docs/icons/apple-touch-icon-180x180.png">
    <link rel="mask-icon" href="/docs/icons/safari-pinned-tab.svg" color="#ea5252">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
    <meta name="description" content="跨平台 Python 异步 QQ 机器人框架">
    <meta name="theme-color" content="#ea5252">
    <meta name="application-name" content="NoneBot">
    <meta name="apple-mobile-web-app-title" content="NoneBot">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#ea5252">
    <link rel="preload" href="/docs/assets/css/0.styles.371e194f.css" as="style"><link rel="preload" href="/docs/assets/js/app.38788b32.js" as="script"><link rel="preload" href="/docs/assets/js/2.9e2d6c06.js" as="script"><link rel="preload" href="/docs/assets/js/6.b71be673.js" as="script"><link rel="preload" href="/docs/assets/js/87.3b08dca4.js" as="script"><link rel="preload" href="/docs/assets/js/5.1299c054.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.34c391ea.js"><link rel="prefetch" href="/docs/assets/js/100.d274dbe6.js"><link rel="prefetch" href="/docs/assets/js/101.1db2e1e6.js"><link rel="prefetch" href="/docs/assets/js/102.b8dc5f2f.js"><link rel="prefetch" href="/docs/assets/js/103.f127f960.js"><link rel="prefetch" href="/docs/assets/js/104.07d5d8bb.js"><link rel="prefetch" href="/docs/assets/js/105.94f9871d.js"><link rel="prefetch" href="/docs/assets/js/106.108ef2c3.js"><link rel="prefetch" href="/docs/assets/js/107.ad85531f.js"><link rel="prefetch" href="/docs/assets/js/108.686db53f.js"><link rel="prefetch" href="/docs/assets/js/109.eeeed3a3.js"><link rel="prefetch" href="/docs/assets/js/11.b6653ad2.js"><link rel="prefetch" href="/docs/assets/js/110.b712c038.js"><link rel="prefetch" href="/docs/assets/js/111.4a9a4da3.js"><link rel="prefetch" href="/docs/assets/js/112.3c0069a9.js"><link rel="prefetch" href="/docs/assets/js/113.e6869526.js"><link rel="prefetch" href="/docs/assets/js/114.b010fc0e.js"><link rel="prefetch" href="/docs/assets/js/115.519f4be4.js"><link rel="prefetch" href="/docs/assets/js/116.d909d95d.js"><link rel="prefetch" href="/docs/assets/js/117.ea9f1987.js"><link rel="prefetch" href="/docs/assets/js/118.422a4b00.js"><link rel="prefetch" href="/docs/assets/js/119.43cb90bd.js"><link rel="prefetch" href="/docs/assets/js/12.bf84e853.js"><link rel="prefetch" href="/docs/assets/js/120.4af71aa9.js"><link rel="prefetch" href="/docs/assets/js/121.a8698d37.js"><link rel="prefetch" href="/docs/assets/js/122.7a413004.js"><link rel="prefetch" href="/docs/assets/js/123.4bf12088.js"><link rel="prefetch" href="/docs/assets/js/124.85f5a818.js"><link rel="prefetch" href="/docs/assets/js/125.6ac41600.js"><link rel="prefetch" href="/docs/assets/js/126.3229d4fb.js"><link rel="prefetch" href="/docs/assets/js/127.e8a1bf8e.js"><link rel="prefetch" href="/docs/assets/js/128.85eadc4a.js"><link rel="prefetch" href="/docs/assets/js/129.a764f15f.js"><link rel="prefetch" href="/docs/assets/js/13.1c3134d0.js"><link rel="prefetch" href="/docs/assets/js/130.86f727cd.js"><link rel="prefetch" href="/docs/assets/js/131.87ca5df7.js"><link rel="prefetch" href="/docs/assets/js/132.97947577.js"><link rel="prefetch" href="/docs/assets/js/133.b4522f91.js"><link rel="prefetch" href="/docs/assets/js/134.f8db0c49.js"><link rel="prefetch" href="/docs/assets/js/135.59d3348a.js"><link rel="prefetch" href="/docs/assets/js/136.5e362aaa.js"><link rel="prefetch" href="/docs/assets/js/137.bf9803da.js"><link rel="prefetch" href="/docs/assets/js/138.db37b848.js"><link rel="prefetch" href="/docs/assets/js/139.5ac0ed22.js"><link rel="prefetch" href="/docs/assets/js/14.a5cbdfe9.js"><link rel="prefetch" href="/docs/assets/js/140.0abbbc62.js"><link rel="prefetch" href="/docs/assets/js/141.45dafad3.js"><link rel="prefetch" href="/docs/assets/js/142.13a9c867.js"><link rel="prefetch" href="/docs/assets/js/143.7564c6a3.js"><link rel="prefetch" href="/docs/assets/js/144.881f12a4.js"><link rel="prefetch" href="/docs/assets/js/145.d5a0bd41.js"><link rel="prefetch" href="/docs/assets/js/146.1984aa72.js"><link rel="prefetch" href="/docs/assets/js/147.0949814e.js"><link rel="prefetch" href="/docs/assets/js/148.b41e01d2.js"><link rel="prefetch" href="/docs/assets/js/149.b998b4d4.js"><link rel="prefetch" href="/docs/assets/js/15.cd8f3c0c.js"><link rel="prefetch" href="/docs/assets/js/150.4f1188c4.js"><link rel="prefetch" href="/docs/assets/js/151.c9a83fa7.js"><link rel="prefetch" href="/docs/assets/js/152.52c8b98b.js"><link rel="prefetch" href="/docs/assets/js/153.692ed4c2.js"><link rel="prefetch" href="/docs/assets/js/154.956bca09.js"><link rel="prefetch" href="/docs/assets/js/155.1d5169be.js"><link rel="prefetch" href="/docs/assets/js/156.a1ab11e9.js"><link rel="prefetch" href="/docs/assets/js/157.181f6eef.js"><link rel="prefetch" href="/docs/assets/js/158.cb4689bf.js"><link rel="prefetch" href="/docs/assets/js/159.34a76301.js"><link rel="prefetch" href="/docs/assets/js/16.6361e6e0.js"><link rel="prefetch" href="/docs/assets/js/160.2b34fd51.js"><link rel="prefetch" href="/docs/assets/js/161.01dbab4d.js"><link rel="prefetch" href="/docs/assets/js/17.286a791f.js"><link rel="prefetch" href="/docs/assets/js/18.c652c7d0.js"><link rel="prefetch" href="/docs/assets/js/19.328ae505.js"><link rel="prefetch" href="/docs/assets/js/20.498b9284.js"><link rel="prefetch" href="/docs/assets/js/21.0e503512.js"><link rel="prefetch" href="/docs/assets/js/22.b91b48ef.js"><link rel="prefetch" href="/docs/assets/js/23.fabcd764.js"><link rel="prefetch" href="/docs/assets/js/24.d830ad62.js"><link rel="prefetch" href="/docs/assets/js/25.87f632af.js"><link rel="prefetch" href="/docs/assets/js/26.d7d60a5e.js"><link rel="prefetch" href="/docs/assets/js/27.82cf396a.js"><link rel="prefetch" href="/docs/assets/js/28.8ea45a6a.js"><link rel="prefetch" href="/docs/assets/js/29.a16f0ffa.js"><link rel="prefetch" href="/docs/assets/js/3.08dd197d.js"><link rel="prefetch" href="/docs/assets/js/30.f7a032e1.js"><link rel="prefetch" href="/docs/assets/js/31.9a0295c2.js"><link rel="prefetch" href="/docs/assets/js/32.8a8d2aac.js"><link rel="prefetch" href="/docs/assets/js/33.2db0e236.js"><link rel="prefetch" href="/docs/assets/js/34.c6299224.js"><link rel="prefetch" href="/docs/assets/js/35.c5ee035f.js"><link rel="prefetch" href="/docs/assets/js/36.cb53e510.js"><link rel="prefetch" href="/docs/assets/js/37.b11e45b6.js"><link rel="prefetch" href="/docs/assets/js/38.503e55df.js"><link rel="prefetch" href="/docs/assets/js/39.150c5968.js"><link rel="prefetch" href="/docs/assets/js/4.8df46d24.js"><link rel="prefetch" href="/docs/assets/js/40.71ad37e2.js"><link rel="prefetch" href="/docs/assets/js/41.89371e59.js"><link rel="prefetch" href="/docs/assets/js/42.feb87fb3.js"><link rel="prefetch" href="/docs/assets/js/43.316468a7.js"><link rel="prefetch" href="/docs/assets/js/44.f9eb910b.js"><link rel="prefetch" href="/docs/assets/js/45.106abeb6.js"><link rel="prefetch" href="/docs/assets/js/46.7fb2fd84.js"><link rel="prefetch" href="/docs/assets/js/47.c39fd7ea.js"><link rel="prefetch" href="/docs/assets/js/48.f1708c5e.js"><link rel="prefetch" href="/docs/assets/js/49.030e1530.js"><link rel="prefetch" href="/docs/assets/js/50.31d90660.js"><link rel="prefetch" href="/docs/assets/js/51.024f21cc.js"><link rel="prefetch" href="/docs/assets/js/52.b37ac7c1.js"><link rel="prefetch" href="/docs/assets/js/53.2d70c108.js"><link rel="prefetch" href="/docs/assets/js/54.d59b05ab.js"><link rel="prefetch" href="/docs/assets/js/55.b0b26b93.js"><link rel="prefetch" href="/docs/assets/js/56.15afade3.js"><link rel="prefetch" href="/docs/assets/js/57.8890cfb4.js"><link rel="prefetch" href="/docs/assets/js/58.a010dc5e.js"><link rel="prefetch" href="/docs/assets/js/59.b218d361.js"><link rel="prefetch" href="/docs/assets/js/60.6db21a10.js"><link rel="prefetch" href="/docs/assets/js/61.0277b5aa.js"><link rel="prefetch" href="/docs/assets/js/62.b4561c72.js"><link rel="prefetch" href="/docs/assets/js/63.44ebdb05.js"><link rel="prefetch" href="/docs/assets/js/64.4537d754.js"><link rel="prefetch" href="/docs/assets/js/65.a67c160a.js"><link rel="prefetch" href="/docs/assets/js/66.7cf298d1.js"><link rel="prefetch" href="/docs/assets/js/67.5c73a7cc.js"><link rel="prefetch" href="/docs/assets/js/68.919e673b.js"><link rel="prefetch" href="/docs/assets/js/69.dffc8623.js"><link rel="prefetch" href="/docs/assets/js/7.a40d52db.js"><link rel="prefetch" href="/docs/assets/js/70.2d47437f.js"><link rel="prefetch" href="/docs/assets/js/71.7eb7089c.js"><link rel="prefetch" href="/docs/assets/js/72.58c11cbc.js"><link rel="prefetch" href="/docs/assets/js/73.db8bc71f.js"><link rel="prefetch" href="/docs/assets/js/74.08e83a90.js"><link rel="prefetch" href="/docs/assets/js/75.46119b84.js"><link rel="prefetch" href="/docs/assets/js/76.602e3acc.js"><link rel="prefetch" href="/docs/assets/js/77.dd923a81.js"><link rel="prefetch" href="/docs/assets/js/78.801b73bc.js"><link rel="prefetch" href="/docs/assets/js/79.bddb250d.js"><link rel="prefetch" href="/docs/assets/js/8.6151909e.js"><link rel="prefetch" href="/docs/assets/js/80.75273eb0.js"><link rel="prefetch" href="/docs/assets/js/81.5dbf1d9b.js"><link rel="prefetch" href="/docs/assets/js/82.6723248f.js"><link rel="prefetch" href="/docs/assets/js/83.46b2eb21.js"><link rel="prefetch" href="/docs/assets/js/84.93af41b4.js"><link rel="prefetch" href="/docs/assets/js/85.5068371c.js"><link rel="prefetch" href="/docs/assets/js/86.757790f7.js"><link rel="prefetch" href="/docs/assets/js/88.961359da.js"><link rel="prefetch" href="/docs/assets/js/89.a00ec3c5.js"><link rel="prefetch" href="/docs/assets/js/9.9f7b0cf9.js"><link rel="prefetch" href="/docs/assets/js/90.75b27e14.js"><link rel="prefetch" href="/docs/assets/js/91.e227d9f1.js"><link rel="prefetch" href="/docs/assets/js/92.e90f3cb1.js"><link rel="prefetch" href="/docs/assets/js/93.1a1dc759.js"><link rel="prefetch" href="/docs/assets/js/94.c5d79a0a.js"><link rel="prefetch" href="/docs/assets/js/95.0e3a5bc9.js"><link rel="prefetch" href="/docs/assets/js/96.3d651c55.js"><link rel="prefetch" href="/docs/assets/js/97.c0235193.js"><link rel="prefetch" href="/docs/assets/js/98.664492db.js"><link rel="prefetch" href="/docs/assets/js/99.de72ad58.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.371e194f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="main-docs-wrapper"><div class="main-content-wrapper"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/logo.png" alt="NoneBot" class="logo"> <span class="site-name can-hide">NoneBot</span></a> <div class="versions-dropdown can-hide"><div class="dropdown-wrapper"><button type="button" aria-label="2.0.0a9.post1" class="dropdown-title"><span class="title">2.0.0a9.post1</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/next/advanced/scheduler.html" class="nav-link">
  master
  <span class="sub-text">next</span></a></li><li class="dropdown-item"><!----> <a href="/docs/advanced/scheduler.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.0.0a9.post1
  <span class="sub-text">current</span></a></li><li class="dropdown-item"><!----> <a href="/docs/2.0.0a8.post2/advanced/scheduler.html" class="nav-link">
  2.0.0a8.post2
  <!----></a></li><li class="dropdown-item"><!----> <a href="/docs/2.0.0a7/advanced/scheduler.html" class="nav-link">
  2.0.0a7
  <!----></a></li></ul></div></div> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  主页
  <!----></a></div><div class="nav-item"><a href="/docs/guide/" class="nav-link">
  指南
  <!----></a></div><div class="nav-item"><a href="/docs/advanced/" class="nav-link">
  进阶
  <!----></a></div><div class="nav-item"><a href="/docs/api/" class="nav-link">
  API
  <!----></a></div><div class="nav-item"><a href="/docs/plugin-store.html" class="nav-link">
  插件广场
  <!----></a></div><div class="nav-item"><a href="/docs/changelog.html" class="nav-link">
  更新日志
  <!----></a></div> <a href="https://github.com/nonebot/nonebot2" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div> <!----></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div class="versions-dropdown can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="2.0.0a9.post1" class="dropdown-title"><span class="title">2.0.0a9.post1</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/next/advanced/scheduler.html" class="nav-link">
  master
  <span class="sub-text">next</span></a></li><li class="dropdown-item"><!----> <a href="/docs/advanced/scheduler.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.0.0a9.post1
  <span class="sub-text">current</span></a></li><li class="dropdown-item"><!----> <a href="/docs/2.0.0a8.post2/advanced/scheduler.html" class="nav-link">
  2.0.0a8.post2
  <!----></a></li><li class="dropdown-item"><!----> <a href="/docs/2.0.0a7/advanced/scheduler.html" class="nav-link">
  2.0.0a7
  <!----></a></li></ul></div></div></div> <nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  主页
  <!----></a></div><div class="nav-item"><a href="/docs/guide/" class="nav-link">
  指南
  <!----></a></div><div class="nav-item"><a href="/docs/advanced/" class="nav-link">
  进阶
  <!----></a></div><div class="nav-item"><a href="/docs/api/" class="nav-link">
  API
  <!----></a></div><div class="nav-item"><a href="/docs/plugin-store.html" class="nav-link">
  插件广场
  <!----></a></div><div class="nav-item"><a href="/docs/changelog.html" class="nav-link">
  更新日志
  <!----></a></div> <a href="https://github.com/nonebot/nonebot2" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/advanced/" aria-current="page" class="sidebar-link">深入</a></li><li><a href="/docs/advanced/scheduler.html" aria-current="page" class="active sidebar-link">定时任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#从-nonebot-v1-迁移" class="active sidebar-link">从 NoneBot v1 迁移</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#安装插件" class="sidebar-link">安装插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#通过-nb-cli" class="sidebar-link">通过 nb-cli</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#通过-poetry" class="sidebar-link">通过 poetry</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#快速上手" class="sidebar-link">快速上手</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#分步进行" class="sidebar-link">分步进行</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#导入-scheduler-对象" class="sidebar-link">导入 scheduler 对象</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#编写定时任务" class="sidebar-link">编写定时任务</a></li><li class="sidebar-sub-header"><a href="/docs/advanced/scheduler.html#配置插件选项" class="sidebar-link">配置插件选项</a></li></ul></li></ul></li><li><a href="/docs/advanced/permission.html" class="sidebar-link">权限控制</a></li><li><a href="/docs/advanced/runtime-hook.html" class="sidebar-link">钩子函数</a></li><li><a href="/docs/advanced/export-and-require.html" class="sidebar-link">跨插件访问</a></li><li><a href="/docs/advanced/overloaded-handlers.html" class="sidebar-link">事件处理函数重载</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>发布</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/advanced/publish-plugin.html" class="sidebar-link">发布插件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content content__default"><h1 id="定时任务"><a href="#定时任务" class="header-anchor">#</a> 定时任务</h1> <p><a href="https://apscheduler.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer"><code>APScheduler</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> —— Advanced Python Scheduler</p> <blockquote><p>Advanced Python Scheduler (APScheduler) is a Python library that lets you schedule your Python code to be executed later, either just once or periodically. You can add new jobs or remove old ones on the fly as you please. If you store your jobs in a database, they will also survive scheduler restarts and maintain their state. When the scheduler is restarted, it will then run all the jobs it should have run while it was offline.</p></blockquote> <h2 id="从-nonebot-v1-迁移"><a href="#从-nonebot-v1-迁移" class="header-anchor">#</a> 从 NoneBot v1 迁移</h2> <p><code>APScheduler</code> 作为 <code>nonebot</code> v1 的可选依赖，为众多 bot 提供了方便的定时任务功能。<code>nonebot2</code> 已将 <code>APScheduler</code> 独立为 <code>nonebot_plugin_apscheduler</code> 插件，你可以在 <a href="https://v2.nonebot.dev/plugin-store.html" target="_blank" rel="noopener noreferrer">插件广场<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中找到它。</p> <p>相比于 <code>nonebot</code> v1 ，只需要安装插件并修改 <code>scheduler</code> 的导入方式即可完成迁移。</p> <h2 id="安装插件"><a href="#安装插件" class="header-anchor">#</a> 安装插件</h2> <h3 id="通过-nb-cli"><a href="#通过-nb-cli" class="header-anchor">#</a> 通过 nb-cli</h3> <p>如正在使用 <code>nb-cli</code> 构建项目，你可以从插件市场复制安装命令或手动输入以下命令以添加 <code>nonebot_plugin_apscheduler</code>。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>nb plugin <span class="token function">install</span> nonebot_plugin_apscheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>nb-cli</code> 默认通过 <code>pypi</code> 安装，你可以添加命令参数 <code>-i [mirror]</code> 或 <code>--index [mirror]</code> 以使用镜像源安装。</p></div> <h3 id="通过-poetry"><a href="#通过-poetry" class="header-anchor">#</a> 通过 poetry</h3> <p>执行以下命令以添加 <code>nonebot_plugin_apscheduler</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>poetry <span class="token function">add</span> nonebot-plugin-apscheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>由于稍后我们将使用 <code>nonebot.require()</code> 方法进行导入，所以无需额外的 <code>nonebot.load_plugin()</code></p></div> <h2 id="快速上手"><a href="#快速上手" class="header-anchor">#</a> 快速上手</h2> <ol><li><p>在需要设置定时任务的插件中，通过 <code>nonebot.require</code> 从 <code>nonebot_plugin_apscheduler</code> 导入 <code>scheduler</code> 对象</p></li> <li><p>在该对象的基础上，根据 <code>APScheduler</code> 的使用方法进一步配置定时任务</p></li></ol> <p>将上述步骤归纳为最小实现的代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> nonebot <span class="token keyword">import</span> require

scheduler <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'nonebot_plugin_apscheduler'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scheduler

<span class="token decorator annotation punctuation">@scheduler<span class="token punctuation">.</span>scheduled_job</span><span class="token punctuation">(</span><span class="token string">'cron'</span><span class="token punctuation">,</span> hour<span class="token operator">=</span><span class="token string">'*/2'</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">{</span>arg2<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run_every_2_hour</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>run_every_day_from_program_start<span class="token punctuation">,</span> <span class="token string">&quot;interval&quot;</span><span class="token punctuation">,</span> days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="分步进行"><a href="#分步进行" class="header-anchor">#</a> 分步进行</h2> <h3 id="导入-scheduler-对象"><a href="#导入-scheduler-对象" class="header-anchor">#</a> 导入 scheduler 对象</h3> <p>为了使插件能够实现定时任务，需要先将 <code>scheduler</code> 对象导入插件。</p> <p><code>nonebot2</code> 提供了 <code>nonebot.require</code> 方法来实现导入其他插件的内容，此处我们使用这个方法来导入 <code>scheduler</code> 对象。</p> <p><code>nonebot</code> 使用的 <code>scheduler</code> 对象为 <code>AsyncScheduler</code> 。</p> <blockquote><p>使用该方法传入的插件本身也需要有对应实现，关于该方法的更多介绍可以参阅 <a href="/docs/advanced/export-and-require.html">这里</a></p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> nonebot <span class="token keyword">import</span> require

scheduler <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'nonebot_plugin_apscheduler'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scheduler
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="编写定时任务"><a href="#编写定时任务" class="header-anchor">#</a> 编写定时任务</h3> <p>由于本部分为标准的通过 <code>APScheduler</code> 配置定时任务，有关指南请参阅 <a href="https://apscheduler.readthedocs.io/en/latest/userguide.html#adding-jobs" target="_blank" rel="noopener noreferrer">APScheduler 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="配置插件选项"><a href="#配置插件选项" class="header-anchor">#</a> 配置插件选项</h3> <p>根据项目的 <code>.env</code> 文件设置，向 <code>.env.*</code> 或 <code>bot.py</code> 文件添加 <code>nonebot_plugin_apscheduler</code> 的可选配置项</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p><code>.env.*</code> 文件的编写应遵循 nonebot2 对 <code>.env.*</code> 文件的编写要求</p></div> <h4 id="apscheduler-autostart"><a href="#apscheduler-autostart" class="header-anchor">#</a> <code>apscheduler_autostart</code></h4> <p>类型：<code>bool</code></p> <p>默认值：<code>True</code></p> <p>是否自动启动 <code>APScheduler</code>。</p> <p>对于大多数情况，我们需要在 <code>nonebot2</code> 项目被启动时启动定时任务，则此处设为 <code>true</code></p> <h5 id="在-env-中添加"><a href="#在-env-中添加" class="header-anchor">#</a> 在 <code>.env</code> 中添加</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">APSCHEDULER_AUTOSTART</span><span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="在-bot-py-中添加"><a href="#在-bot-py-中添加" class="header-anchor">#</a> 在 <code>bot.py</code> 中添加</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code>nonebot<span class="token punctuation">.</span>init<span class="token punctuation">(</span>apscheduler_autostart<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="apscheduler-config"><a href="#apscheduler-config" class="header-anchor">#</a> <code>apscheduler_config</code></h4> <p>类型：<code>dict</code></p> <p>默认值：<code>{&quot;apscheduler.timezone&quot;: &quot;Asia/Shanghai&quot;}</code></p> <p><code>APScheduler</code> 相关配置。修改/增加其中配置项需要确保 <code>prefix: apscheduler</code>。</p> <p>对于 <code>APScheduler</code> 的相关配置，请参阅 <a href="https://apscheduler.readthedocs.io/en/latest/userguide.html#scheduler-config" target="_blank" rel="noopener noreferrer">scheduler-config<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://apscheduler.readthedocs.io/en/latest/modules/schedulers/base.html#apscheduler.schedulers.base.BaseScheduler" target="_blank" rel="noopener noreferrer">BaseScheduler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>官方文档在绝大多数时候能提供最准确和最具时效性的指南</p></blockquote> <h5 id="在-env-中添加-2"><a href="#在-env-中添加-2" class="header-anchor">#</a> 在 <code>.env</code> 中添加</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">APSCHEDULER_CONFIG</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;apscheduler.timezone&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Asia/Shanghai&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="在-bot-py-中添加-2"><a href="#在-bot-py-中添加-2" class="header-anchor">#</a> 在 <code>bot.py</code> 中添加</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code>nonebot<span class="token punctuation">.</span>init<span class="token punctuation">(</span>apscheduler_config<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">&quot;apscheduler.timezone&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Asia/Shanghai&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nonebot/nonebot2/edit/dev/archive//2.0.0a9.post1/advanced/scheduler.html" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/7/2021, 3:42:08 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/advanced/" class="prev router-link-active">
        深入
      </a></span> <span class="next"><a href="/docs/advanced/permission.html">
        权限控制
      </a>
      →
    </span></p></div> </main> <!----></div></div> <!----></div><div class="global-ui"><!----><!----></div></div>
    
    <script src="/docs/assets/js/app.38788b32.js" defer></script><script src="/docs/assets/js/2.9e2d6c06.js" defer></script><script src="/docs/assets/js/6.b71be673.js" defer></script><script src="/docs/assets/js/87.3b08dca4.js" defer></script><script src="/docs/assets/js/5.1299c054.js" defer></script>
  </body>
</html>
