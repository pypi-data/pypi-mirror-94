<!-- HTML header for doxygen 1.8.16-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=9" />
<meta name="generator" content="Doxygen 1.8.18" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="Description" content="Machina Client SDK Version 2.1.0: Ionic Security Machina Client SDK for Python users" />
<meta name="keywords" content="ionicsdk.chunkcipher.ChunkCipherAuto" />
<meta name="keywords" content="ionicsdk.services.AgentKeyServicesBase" />
<title>Machina Client SDK Version 2.1.0: AgentKeyServices Implementors Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
<link href="ISAgentSDK.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Machina Client SDK Version 2.1.0
   </div>
   <div id="projectbrief">Ionic Security Machina Client SDK for Python users</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">AgentKeyServices Implementors Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#isagentkeyservices-introduction">Introduction to AgentKeyServicesBase</a></li>
<li class="level1"><a href="#isagentkeyservices-using">Using AgentKeyServicesBase</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="isagentkeyservices-introduction"></a>
Introduction to AgentKeyServicesBase</h1>
<p><a class="el" href="classionicsdk_1_1services_1_1_agent_key_services_base.html" title="AgentKeyServicesBase class performs all key related services (create and get) for higher level object...">ionicsdk.services.AgentKeyServicesBase</a> is an interface that users of the SDK can use to write their own custom key services that our ciphers can use.</p>
<p><br />
</p>
<h1><a class="anchor" id="isagentkeyservices-using"></a>
Using AgentKeyServicesBase</h1>
<p>You can define your own key services class by implementing the interface defined in Services.py.</p>
<p>An example below illustrates creating a key services class and creating a <a class="el" href="classionicsdk_1_1chunkcipher_1_1_chunk_cipher_auto.html" title="Cipher that automatically chooses the correct cipher to use for data chunk encryption / decryption.">ionicsdk.chunkcipher.ChunkCipherAuto</a> cipher using that service.</p>
<p><b>Example Custom Key Services:</b> </p><div class="fragment"><div class="line">class PassThruAgent(ionicsdk.AgentKeyServicesBase):</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>__init__(self, agentkeyservice):</div>
<div class="line">        <span class="comment"># This custom implementation is just a wrapper around an existing Ionic Agent Service</span></div>
<div class="line">        self.services = agentkeyservice</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># Our wrapper attempts to reduce the number of server calls by creating local caches</span></div>
<div class="line">        self.cachedNewKeys = []</div>
<div class="line">        self.cacheExistingKeys = {}</div>
<div class="line">        self.cacheNum = 16</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># Our wrapper also simplifies the interface by having a local copy of the attributes and metadata</span></div>
<div class="line">        self.attributes = { <span class="stringliteral">"classifications"</span>: [<span class="stringliteral">"c1"</span>, <span class="stringliteral">"c2"</span>], <span class="stringliteral">"color"</span>: [<span class="stringliteral">"green"</span>] }</div>
<div class="line">        self.metadata = { <span class="stringliteral">"test-meta-key"</span>: <span class="stringliteral">"test-meta-value"</span> }</div>
<div class="line">        self.mutableAttributes = {<span class="stringliteral">u"test-mutable-1"</span>: [<span class="stringliteral">u"test-mutable-value-1"</span>, <span class="stringliteral">u"test-mutable-value-2"</span>], <span class="stringliteral">u"test-mutable-2"</span>:[<span class="stringliteral">u"test-mutable-value-1"</span>,]}</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># This lets us check that the cache is working</span></div>
<div class="line">        self.serverCalls = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>hasactiveprofile(self):</div>
<div class="line">        <span class="comment"># We can just pass through to the Ionic Service in some cases</span></div>
<div class="line">        <span class="keywordflow">return</span> self.services.hasactiveprofile()</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>getactiveprofile(self):</div>
<div class="line">        <span class="keywordflow">return</span> self.services.getactiveprofile</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>createkey(self, attributesdict = None, metadatadict = None, mutableAttributesdict = None):</div>
<div class="line">        <span class="comment"># If our cache is empty, request a number of keys</span></div>
<div class="line">        <span class="keywordflow">if</span> len(self.cachedNewKeys) == 0:</div>
<div class="line">            <span class="comment"># Record our server call</span></div>
<div class="line">            self.serverCalls += 1</div>
<div class="line">            <span class="comment"># In this example, we're ignoring the attributes passed in and use the local ones.  By using a standard set of</span></div>
<div class="line">            <span class="comment"># attributes, we can actually do this cache.  We could combine with the method parameters or let them over-ride,</span></div>
<div class="line">            <span class="comment"># but then we would need to make sure cache keys actually used the correct attributes.</span></div>
<div class="line">            self.cachedNewKeys = self.services.createkeys(self.cacheNum, self.attributes, self.metadata, self.mutableAttributes)</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># Grab a key from the new key cache.</span></div>
<div class="line">        key = self.cachedNewKeys.pop()</div>
<div class="line">        <span class="comment"># Add this key to the in use key cache, so GetKey calls won't have to go to the server.</span></div>
<div class="line">        self.cacheExistingKeys[key.id] = key</div>
<div class="line">        <span class="keywordflow">return</span> key</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>createkeys(self, keycount, attributesdict = None, metadatadict = None, mutableAttributesdict = None):</div>
<div class="line">        <span class="comment"># If we still have enough keys in cache use those, otherwise, just pass thru.</span></div>
<div class="line">        <span class="keywordflow">if</span> len(self.cachedNewKeys) &gt;= keycount:</div>
<div class="line">            keys = []</div>
<div class="line">            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(keycount):</div>
<div class="line">                keys.append(self.cachedNewKeys.pop())</div>
<div class="line">        <span class="keywordflow">else</span>:</div>
<div class="line">            <span class="comment"># Record our server call.</span></div>
<div class="line">            self.serverCalls += 1</div>
<div class="line">            keys = self.services.createkeys(keycount, self.attributes, self.metadata, self.mutableAttributes)</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># Add these keys to the in use key cache, so GetKey calls won't have to go to the server.</span></div>
<div class="line">        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> keys:</div>
<div class="line">            self.cacheExistingKeys[key.id] = key</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> keys</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>getkey(self, keyidstring, metadatadict = None):</div>
<div class="line">        <span class="comment"># Check if the key is in cache, if so return immediately.</span></div>
<div class="line">        key = self.cacheExistingKeys.get(keyidstring)</div>
<div class="line">        <span class="keywordflow">if</span> key:</div>
<div class="line">            <span class="keywordflow">return</span> key</div>
<div class="line"> </div>
<div class="line">        <span class="comment"># If the key is not in cache, it might have been created in a previous run of this code and therefore not in cache.</span></div>
<div class="line">        <span class="comment"># In that case, we can just pass through.</span></div>
<div class="line">        self.serverCalls += 1</div>
<div class="line">        key = self.services.getkey(keyidstring, self.metadata)</div>
<div class="line">        <span class="comment"># Add this key to the in use key cache.</span></div>
<div class="line">        self.cacheExistingKeys[key.id] = key</div>
<div class="line">        <span class="keywordflow">return</span> key</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">def </span>getkeys(self, keyidstringlist, metadatadict = None):</div>
<div class="line">        <span class="comment"># Run through the list of requested keys and find the ones in cache and the ones we need to try to retrieve from the server.</span></div>
<div class="line">        keys = []</div>
<div class="line">        unfoundIds = []</div>
<div class="line">        <span class="keywordflow">for</span> keyid <span class="keywordflow">in</span> keyidstringlist:</div>
<div class="line">            key = self.cacheExistingKeys.get(keyid)</div>
<div class="line">            <span class="keywordflow">if</span> key:</div>
<div class="line">                keys.append(key)</div>
<div class="line">            <span class="keywordflow">else</span>:</div>
<div class="line">                unfoundIds.append(keyid)</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> len(unfoundIds):</div>
<div class="line">            self.serverCalls += 1</div>
<div class="line">            serverKeys = self.services.getkeys(unfoundIds, self.metadata)</div>
<div class="line">            keys.extend(serverKeys)</div>
<div class="line"> </div>
<div class="line">            <span class="comment"># Add these keys to the in use key cache.</span></div>
<div class="line">            <span class="keywordflow">for</span> key <span class="keywordflow">in</span> serverKeys:</div>
<div class="line">                self.cacheExistingKeys[key.id] = key</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> keys</div>
</div><!-- fragment --><p> <br />
 <b>Using our example key services class:</b> </p><div class="fragment"><div class="line"><span class="comment"># Create a normal Ionic Agent Service</span></div>
<div class="line">plaintextPersistor = ionicsdk.DeviceProfilePersistorPlaintextFile(<span class="stringliteral">"plaintext.sep"</span>)</div>
<div class="line">agent = ionicsdk.Agent(profilepersistor=plaintextPersistor)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create our wrapper</span></div>
<div class="line">wrappedAgent = PassThruAgent(agent)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># initialize a cipher using our custom service</span></div>
<div class="line">cipher = ionicsdk.ChunkCipherAuto(wrappedAgent)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer" /><address class="footer">
<p class="small">You acknowledge your access, review and use of the documentation on this page is subject to the Ionic Security Inc. <a href="https://dev.ionic.com/use.html">Documentation Use Rights</a>.</p>
<p class="small">&copy; 2016-2021 Ionic Security Inc. All rights reserved.&#160;-&#160;
Generated on Wed Feb 3 2021 17:16:19 for Machina Client SDK Version 2.1.0 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen" />
</a> 1.8.18 </p>
</address>

</body>
</html>
