{% load social_share wagtailimages_tags wagtailcore_tags my %}

<div id="block-blog-intro" class="header-padding stream_content theme-bg-space">

    {% include 'cms/blocks/common/bg.html' with block_num=1 theme=page.theme bg_desktop=page.bg_desktop bg_mobile=page.bg_mobile pos="center" layer=1 rendition_mobile='width-600' rendition_desktop='width-1920' %}

    <div class="container regular theme-space">
        <div class="stream-content-container left">
            <div class="align-text-left">
                <h1>{{ page.h1 }}</h1>
                {% include 'cms/blocks/common/tags_blog.html' with root_page=page.get_parent tags=page.tags.all links=1 %}
                <div class="rich-text-container">
                    <div class="rich-text">
                        {{ page.intro_page|richtext }}
                    </div>
                </div>
                <div class="s-flex-align">
                    <div class="article-author-img">
                        <picture>

                            {% image page.author.image_presentation fill-40x40 format-webp as md_image_webp %}
                            <source media="(min-width: 1px)" srcset="{{ md_image_webp.url }}" type="image/webp">

                            {% image page.author.image_presentation fill-40x40 format-jpeg as md_image_jpeg %}
                            <source media="(min-width: 1px)" srcset="{{ md_image_jpeg.url }}" type="image/jpeg">

                            <img loading="lazy" data-src="{{ md_image_jpeg.url }}"
                                 class="s-icon x2 nopad"
                                 alt="{{ img.title }}"
                            />
                        </picture>
                    </div>
                    <div class="article-author">
                        <p>{{ page.author.first_name }} {{ page.author.last_name }}</p>
                        <small>{{ page.date|date }}{% if page.date_updated %} (Mis à jour le
                            {{ page.date_updated|date }}){% endif %} • {{ page.read_time }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if request.user_agent.is_pc %}
    <div id="blog-content-container" class="theme-bg-light">{% endif %}


{% comment %}---------------------------- Summary ----------------------------{% endcomment %}

{% if summary %}
    <div id="block-summary" class="theme-bg-light">
        <div class="container content theme-light">
            <div>
                <div class="rich-text-container">
                    {{ page.get_parent.specific.summary_text|richtext }}
                    <ul class="ul-summary">
                        {% for h2 in summary %}
                            <li>
                                <a href="#{{ h2.link }}">
                                    <p>{{ h2.content }}</p>
                                </a>
                                {% if h2.h3 %}
                                    <ul class="summary-sublinks">
                                        {% for h3 in h2.h3 %}
                                            <li>
                                                <a href="#{{ h3.link }}">
                                                    <p>{{ h3.content }}</p>
                                                </a>
                                                {% comment %}{% if h3.h4 %}
                                                        <ul>
                                                            {% for h4 in h3.h4 %}
                                                                <li>
                                                                    <a href="#{{ h4.link }}">
                                                                        <p>{{ h4.content }}</p>
                                                                    </a>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    {% endif %}{% endcomment %}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
{% else %}
    <div id="block-summary" class="theme-bg-light">
        <div class="container content nopadbottom theme-light">
            <div class="rich-text-container">
                <h2 class="error">Erreur Sommaire</h2>
                <h3>Le sommaire ne peut pas être généré</h3>
                <p>Il y a une/des erreur(s) dans le contenue de la page sur l'architecture des titres h2, h3, h4 ,
                    h5.</p>
            </div>
        </div>
    </div>
{% endif %}

{% comment %}---------------------------- Content ----------------------------{% endcomment %}

<div id="content-blog">
    {% for block in page.body %}
        {% include_block block with block_num=forloop.counter|add:1 container='content' %}
    {% endfor %}
</div>

{% if request.user_agent.is_pc %}</div>{% endif %}

{% comment %}---------------------------- Articles related ----------------------------{% endcomment %}

{% if page.related_blogs %}
    <div id="block-title-article-related" class="text theme-bg-light">
        <div class="container content theme-light">
            <div class="rich-text-container align-text-center">
                {{ page.get_parent.specific.related_articles_text|richtext }}
            </div>
        </div>
    </div>
    <div id="block-article-related" class="theme-bg-light">
        <div class="container regular nopadtop nopadbottom theme-light">
            <div class="articles-container">
                {% for blog in page.related_blogs %}
                    {% include 'cms/blocks/common/article.html' with blog=blog.value theme='light-inverse' %}
                {% endfor %}
            </div>
        </div>
    </div>
    <div id="block-6" class="buttons theme-bg-light">
        <div class="container content theme-light">
            <div class="btn-container align-text-center">
                <a class="btn secondary-full space-c" href="{% pageurl page.get_parent %}">
                    {{ page.get_parent.specific.button_view_all_articles }}
                </a>
            </div>
        </div>
    </div>

    {% include 'cms/blocks/static/social_share.html' %}

{% endif %}